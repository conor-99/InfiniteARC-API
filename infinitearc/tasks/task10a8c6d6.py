# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 10a8c6d6
Difficulty: medium–hard

=== Tags ===
- Line collision

=== Description ===
Input grids are 15×15 with a single background color (0). Overlaid on the
background are horizontal and vertical wall segments of distinct colors (1-5),
each wall segment being a solid color. A single line of color 6 starts at the
left edge of the grid, moving rightward. The line travels horizontally until it
collides with a wall. At the collision point, the cell's color changes to the
wall's color, and the line reflects: horizontal walls cause vertical movement
(up or down), while vertical walls cause horizontal movement (left or right).
The line continues in the new direction, and each subsequent collision with a
wall changes the cell to the wall's color and reflects the line again. The
output grid displays the complete path of the line, with each segment's color
corresponding to the wall color at the collision point that initiated that
segment's direction. Walls remain unchanged, and the line never overlaps with
walls or other walls.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width, height = 15, 15
    grid_in = grid(width, height, 0)
    
    y = random.randint(1, height-2)
    x = random.randint(2, width-2)
    c = random.randint(1, 5)
    
    grid_in[y][x] = c
    grid_in[y][x+1] = c
    
    for i in range(x):
        grid_in[y][i] = 6
    
    for r in range(y-1, -1, -1):
        if grid_in[x][r] != 0:
            return generate()
    
    grid_out = [row[:] for row in grid_in]
    for r in range(y-1, -1, -1):
        grid_out[x][r] = c
    
    return {"input": grid_in, "output": grid_out}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid_in = [list(row) for row in input_grid]
    width = len(grid_in[0])
    height = len(grid_in)
    
    start_y = None
    for y in range(height):
        if grid_in[y][0] == 6:
            start_y = y
            break
    if start_y is None:
        return grid_in
    
    x = 0
    y = start_y
    while x < width and grid_in[y][x] == 6:
        x += 1
    if x >= width:
        return grid_in
    c = grid_in[y][x]
    
    is_horizontal = (x+1 < width and grid_in[y][x+1] == c)
    is_vertical = (y+1 < height and grid_in[y+1][x] == c)
    
    if is_horizontal:
        for r in range(y-1, -1, -1):
            if grid_in[x][r] != 0:
                break
            grid_in[x][r] = c
    elif is_vertical:
        for col in range(x-1, -1, -1):
            if grid_in[y][col] != 0:
                break
            grid_in[y][col] = c
    else:
        for r in range(y-1, -1, -1):
            if grid_in[x][r] != 0:
                break
            grid_in[x][r] = c
    
    return grid_in
