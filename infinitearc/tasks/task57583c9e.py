# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 57583c9e
Difficulty: hard

=== Tags ===
- Draw pattern from point
- Image rotation
- Context sensitive recolor
- Adapt image to grid

=== Description ===
The input grids contain a single seed cell (color S, 1-9) from which a straight-
line pattern extends in a direction determined by S (1:right, 2:down, 3:left,
4:up, cycling for S>4), with all pattern cells maintaining color S. The
transformation process involves rotating the entire grid 90 degrees clockwise,
followed by context-sensitive recoloring: any cell with a direct
(up/down/left/right) neighbor of color 5 is changed to color 6, while all other
cells remain unchanged. The output grid reflects these sequential operations,
adapting the pattern's orientation and applying the neighbor-based color rule.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
import common

def generate():
    S = random.randint(1, 9)
    d = (S - 1) % 4 + 1
    # Ensure grid dimensions are sufficient for line length >= 2
    width = random.randint(2, 30) if d in [1, 3] else random.randint(1, 30)
    height = random.randint(2, 30) if d in [2, 4] else random.randint(1, 30)
    input_grid = common.grid(width, height, 0)
    if d == 1:  # right
        r = random.randint(0, height - 1)
        c_start = random.randint(0, width - 2)
        for c in range(c_start, width):
            input_grid[r][c] = S
    elif d == 2:  # down
        c = random.randint(0, width - 1)
        r_start = random.randint(0, height - 2)
        for r in range(r_start, height):
            input_grid[r][c] = S
    elif d == 3:  # left
        r = random.randint(0, height - 1)
        c_start = random.randint(1, width - 1)
        for c in range(c_start, -1, -1):
            input_grid[r][c] = S
    elif d == 4:  # up
        c = random.randint(0, width - 1)
        r_start = random.randint(1, height - 1)
        for r in range(r_start, -1, -1):
            input_grid[r][c] = S
    rotated = [list(x) for x in zip(*input_grid[::-1])]
    output_grid = [row[:] for row in rotated]
    for r in range(len(rotated)):
        for c in range(len(rotated[0])):
            if any((rotated[r + dr][c + dc] == 5 for dr, dc in [(0,1), (0,-1), (1,0), (-1,0)] if 0 <= r+dr < len(rotated) and 0 <= c+dc < len(rotated[0]))):
                output_grid[r][c] = 6
    if input_grid == output_grid:
        return generate()
    return {'input': input_grid, 'output': output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    rotated = [list(x) for x in zip(*input_grid[::-1])]
    output_grid = [row[:] for row in rotated]
    for r in range(len(rotated)):
        for c in range(len(rotated[0])):
            if any((rotated[r + dr][c + dc] == 5 for dr, dc in [(0,1), (0,-1), (1,0), (-1,0)] if 0 <= r+dr < len(rotated) and 0 <= c+dc < len(rotated[0]))):
                output_grid[r][c] = 6
    return output_grid
