# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 86265871
Difficulty: medium

=== Tags ===
- Color guessing
- Close line gaps
- Pattern differences

=== Description ===
The input grids consist of 2D arrays with values 0â€“9, where horizontal and
vertical sequences of the same non-zero color (referred to as "lines") contain
gaps (represented by 0s) within their spans. The task requires closing these
gaps by replacing each 0 that lies between two or more non-zero cells of the
same color in a line (either horizontally or vertically) with that color. For
example, a row like [2, 2, 0, 2] becomes [2, 2, 2, 2] after gap closure, as the
0 is between 2s. Similarly, a column with [5, 0, 5, 5] transforms to [5, 5, 5,
5]. The output grid must preserve all non-gap elements while ensuring all
contiguous line segments of the same color are fully connected without
interruptions. This task challenges the solver to identify line patterns, infer
the correct color for gaps based on surrounding context, and apply consistent
closure rules across horizontal and vertical directions, making it a medium-
difficulty problem involving pattern recognition and relational color deduction.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common

def generate():
    width = common.randint(3, 30)
    height = common.randint(3, 30)
    color = common.random_color()
    output = common.grid(width, height, 0)
    for j in range(width):
        output[0][j] = color
    for i in range(height):
        output[i][0] = color
    input_grid = [row[:] for row in output]
    for j in range(1, width-1):
        if common.random.random() < 0.5:
            input_grid[0][j] = 0
    for i in range(1, height-1):
        if common.random.random() < 0.5:
            input_grid[i][0] = 0
    if all(input_grid[0][j] == color for j in range(width)) and all(input_grid[i][0] == color for i in range(height)):
        j = common.randint(1, width-2)
        input_grid[0][j] = 0
    return {"input": input_grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    output = [row[:] for row in input_grid]
    for i in range(height):
        for j in range(width):
            if output[i][j] == 0:
                left_color = None
                for k in range(j-1, -1, -1):
                    if output[i][k] != 0:
                        left_color = output[i][k]
                        break
                right_color = None
                for k in range(j+1, width):
                    if output[i][k] != 0:
                        right_color = output[i][k]
                        break
                if left_color is not None and right_color is not None and left_color == right_color:
                    output[i][j] = left_color
                    continue
                up_color = None
                for k in range(i-1, -1, -1):
                    if output[k][j] != 0:
                        up_color = output[k][j]
                        break
                down_color = None
                for k in range(i+1, height):
                    if output[k][j] != 0:
                        down_color = output[k][j]
                        break
                if up_color is not None and down_color is not None and up_color == down_color:
                    output[i][j] = up_color
    return output
