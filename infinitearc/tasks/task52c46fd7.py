# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: 52c46fd7
Difficulty: medium

=== Tags ===
- Associate images to colors
- Draw line from point

=== Description ===
The input grid contains horizontal lines of various non-zero colors (each color
representing a distinct visual pattern). Each horizontal line is defined as a
contiguous sequence of cells in the same row sharing the same non-zero color
value. For every such horizontal line, the output grid must include a vertical
line drawn downward from the leftmost cell of the horizontal line, extending to
the bottom edge of the grid. The vertical lines are rendered using a fixed
reference color (e.g., color 5), while all original horizontal lines and
background cells (color 0) remain unchanged. The transformation does not rely on
numerical properties of colors but on their spatial arrangement and visual
association with the horizontal line structure.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(1, 30)
    height = random.randint(1, 30)
    input_grid = [[0] * width for _ in range(height)]
    
    # Generate horizontal runs
    for r in range(height):
        if random.random() < 0.7:  # 70% chance to have a run in this row
            color = random.choice([1, 2, 3, 4, 6, 7, 8, 9])
            start_col = random.randint(0, width - 1)
            length = random.randint(1, width - start_col)
            for c in range(start_col, start_col + length):
                if c < width:
                    input_grid[r][c] = color
    
    # Create output grid
    output_grid = [row[:] for row in input_grid]
    
    # Add vertical lines for each horizontal run's leftmost column
    for r in range(height):
        c = 0
        while c < width:
            if input_grid[r][c] != 0:
                left_col = c
                # Traverse the run
                while c < width and input_grid[r][c] == input_grid[r][left_col]:
                    c += 1
                # Draw vertical line from (r, left_col) down
                for r2 in range(r, height):
                    output_grid[r2][left_col] = 5
            else:
                c += 1
    
    # Ensure input != output
    if input_grid == output_grid:
        if all(cell == 0 for row in input_grid for cell in row):
            r = random.randint(0, height - 1)
            c = random.randint(0, width - 1)
            input_grid[r][c] = random.choice([1, 2, 3, 4, 6, 7, 8, 9])
            output_grid = [row[:] for row in input_grid]
            for r2 in range(r, height):
                output_grid[r2][c] = 5
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = [row[:] for row in input_grid]
    for r in range(height):
        c = 0
        while c < width:
            if input_grid[r][c] != 0:
                left_col = c
                while c < width and input_grid[r][c] == input_grid[r][left_col]:
                    c += 1
                for r2 in range(r, height):
                    output_grid[r2][left_col] = 5
            else:
                c += 1
    return output_grid
