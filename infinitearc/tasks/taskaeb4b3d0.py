# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-03
# ---------------------------------------------------------------

"""
Task ID: aeb4b3d0
Difficulty: medium–hard

=== Tags ===
- Pressure release
- Divide by n

=== Description ===
# Task Description  Input grids feature a central contiguous region of a single
color (the "pressure" region), fully enclosed by background cells. Positioned
near the top-left corner, a horizontal strip of 2-4 repeating 2×2 colored blocks
(the "divide indicator") appears, separated by single background cells. The
strip's pattern defines a cyclic sequence of colors.  The output grid releases
the pressure by dividing the central region into n equal-area segments, where n
corresponds to the number of blocks in the divide indicator. Each segment is
recolored sequentially using the indicator's color pattern. The division is
applied column-wise: the region's bounding box is split into n vertical
sections, with each section assigned the next color in the indicator's sequence.
The original pressure region's shape is preserved within each segment, and all
background cells remain unchanged. The divide indicator strip remains visible in
its original position.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import *

def generate():
    width = random.randint(10, 30)
    height = random.randint(10, 30)
    grid = common.grid(width, height, 0)
    
    C = random_color(exclude=[0])
    size = random.randint(10, 20)
    creature_pixels = continuous_creature(size, width=10, height=10)
    shift_x = 2
    shift_y = 2
    for (r, c) in creature_pixels:
        if r < height - 2 and c < width - 2:
            grid[r + shift_y][c + shift_x] = C
    
    n = random.randint(2, 4)
    colors = [C]
    for _ in range(n-1):
        color = random_color(exclude=[0, C])
        while color in colors:
            color = random_color(exclude=[0, C])
        colors.append(color)
    
    for i in range(n):
        start_col = 3 * i
        for r in range(2):
            for c in range(2):
                if start_col + c < width:
                    grid[r][start_col + c] = colors[i]
    
    rows = []
    cols = []
    for r in range(height):
        for c in range(width):
            if grid[r][c] == C:
                rows.append(r)
                cols.append(c)
    if not rows:
        return generate()
    min_r, max_r = min(rows), max(rows)
    min_c, max_c = min(cols), max(cols)
    width_region = max_c - min_c + 1
    if width_region % n != 0:
        return generate()
    
    output_grid = [row[:] for row in grid]
    segment_width = width_region // n
    for r in range(height):
        for c in range(width):
            if grid[r][c] == C:
                seg_index = (c - min_c) // segment_width
                output_grid[r][c] = colors[seg_index]
    
    if grid == output_grid:
        return generate()
    
    return {
        "input": grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    
    strip_colors = []
    i = 0
    while i < width - 1:
        if input_grid[0][i] == 0:
            i += 1
            continue
        color = input_grid[0][i]
        if (input_grid[0][i] == input_grid[0][i+1] == input_grid[1][i] == input_grid[1][i+1]):
            strip_colors.append(color)
            i += 3
        else:
            i += 1
    n = len(strip_colors)
    if n < 2:
        n = 2
    
    C = strip_colors[0]
    
    pressure_cells = []
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == C:
                pressure_cells.append((r, c))
    if not pressure_cells:
        return input_grid
    
    min_r = min(r for r, c in pressure_cells)
    max_r = max(r for r, c in pressure_cells)
    min_c = min(c for r, c in pressure_cells)
    max_c = max(c for r, c in pressure_cells)
    width_region = max_c - min_c + 1
    
    segment_width = width_region // n
    
    output_grid = [list(row) for row in input_grid]
    for (r, c) in pressure_cells:
        seg_index = (c - min_c) // segment_width
        if seg_index >= n:
            seg_index = n - 1
        output_grid[r][c] = strip_colors[seg_index]
    
    return output_grid
