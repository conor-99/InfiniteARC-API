# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 6d255fd1
Difficulty: hard

=== Tags ===
- Spacing
- Dominant color

=== Description ===
The task involves transforming an input grid into an output grid based on the
dominant color and spacing rules. The dominant color is defined as the most
frequent non-zero color in the input grid. The output grid is generated by
inserting D background rows (filled with color 0) between each pair of
consecutive rows in the input grid, and similarly inserting D background columns
between each pair of consecutive columns, where D is the numeric value of the
dominant color. This spacing creates a grid where the original input structure
is preserved but separated by D rows and columns of background color. The
transformation requires identifying the dominant color through frequency
analysis and applying the spacing rule consistently, making it a challenging
task due to the need for precise color counting and spatial reasoning.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, random_color

def generate():
    while True:
        width = random.randint(2, 30)
        height = random.randint(2, 30)
        input_grid = grid(width, height, 0)
        for r in range(height):
            for c in range(width):
                if random.random() > 0.5:
                    input_grid[r][c] = random_color(exclude=[0])
        if all(x == 0 for row in input_grid for x in row):
            r, c = random.randint(0, height-1), random.randint(0, width-1)
            input_grid[r][c] = random_color(exclude=[0])
        
        non_zero_colors = [color for row in input_grid for color in row if color != 0]
        if non_zero_colors:
            dominant_color = max(set(non_zero_colors), key=non_zero_colors.count)
        else:
            dominant_color = 1
        D = dominant_color
        
        output_height = height + (height - 1) * D
        output_width = width + (width - 1) * D
        
        if output_height <= 30 and output_width <= 30:
            break
    
    output_grid = grid(output_width, output_height, 0)
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] != 0:
                out_r = r * (D + 1)
                out_c = c * (D + 1)
                output_grid[out_r][out_c] = input_grid[r][c]
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

from common import grid

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    non_zero = []
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] != 0:
                non_zero.append(input_grid[r][c])
    if non_zero:
        dominant_color = max(set(non_zero), key=non_zero.count)
    else:
        dominant_color = 1
    D = dominant_color
    output_height = height + (height - 1) * D
    output_width = width + (width - 1) * D
    output_grid = grid(output_width, output_height, 0)
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] != 0:
                out_r = r * (D + 1)
                out_c = c * (D + 1)
                output_grid[out_r][out_c] = input_grid[r][c]
    return output_grid
