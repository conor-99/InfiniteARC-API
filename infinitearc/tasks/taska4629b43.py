# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-03
# ---------------------------------------------------------------

"""
Task ID: a4629b43
Difficulty: very hard

=== Tags ===
- Cut and unfold

=== Description ===
# Task: Folded Symmetry Unfolding  Input grids represent a grid that has been
folded along a single axis (horizontal or vertical), with the folded portion
overlapping the original. The overlap region contains a continuous "cut line" (a
sequence of cells with a unique color not present elsewhere in the grid) that
marks the fold axis. The output grid is the unfolded version, where the folded
section is reflected across the cut line to restore the original grid's
symmetry.  The input grid contains a unique color (not used elsewhere) forming a
straight line (horizontal or vertical) of at least 3 cells, serving as the cut
line. This line is the fold axis. The grid is folded such that one side of the
cut line overlaps the other side. The output grid is generated by reflecting the
non-overlapping portion across the cut line to fill the overlap area, preserving
the cut line and creating a fully symmetric grid. The reflection must maintain
grid boundaries, and the output grid will have the same dimensions as the input.
Background cells (color 0) are overwritten by the reflected colors, while non-
background colors are reflected without modification. The cut line color remains
unchanged in the output.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid
def generate():
    while True:
        width = random.randint(3, 30)
        height = random.randint(3, 30)
        direction = random.choice(['vertical', 'horizontal'])
        
        if direction == 'vertical':
            width = width if width % 2 == 1 else width - 1
            if width < 3:
                width = 3
            c = width // 2
            output = grid(width, height, 0)
            for i in range(height):
                output[i][c] = 9
            for j in range(c):
                for i in range(height):
                    output[i][j] = random.randint(0, 8)
            for j in range(c + 1, width):
                mirror_j = 2 * c - j
                for i in range(height):
                    output[i][j] = output[i][mirror_j]
            input_grid = [row[:] for row in output]
            for j in range(c + 1, width):
                for i in range(height):
                    input_grid[i][j] = input_grid[i][j - (c + 1)]
        else:
            height = height if height % 2 == 1 else height - 1
            if height < 3:
                height = 3
            r = height // 2
            output = grid(width, height, 0)
            for j in range(width):
                output[r][j] = 9
            for i in range(r):
                for j in range(width):
                    output[i][j] = random.randint(0, 8)
            for i in range(r + 1, height):
                mirror_i = 2 * r - i
                for j in range(width):
                    output[i][j] = output[mirror_i][j]
            input_grid = [row[:] for row in output]
            for i in range(r + 1, height):
                for j in range(width):
                    input_grid[i][j] = input_grid[i - (r + 1)][j]
        
        if input_grid != output:
            break
    return {"input": input_grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    input_list = [list(row) for row in input_grid]
    width = len(input_list[0])
    height = len(input_list)
    
    cut_col = None
    for c in range(width):
        if all(input_list[i][c] == 9 for i in range(height)):
            cut_col = c
            break
    
    if cut_col is not None:
        for j in range(cut_col + 1, width):
            mirror_j = 2 * cut_col - j
            for i in range(height):
                input_list[i][j] = input_list[i][mirror_j]
        return input_list
    
    cut_row = None
    for r in range(height):
        if all(input_list[r][j] == 9 for j in range(width)):
            cut_row = r
            break
    
    if cut_row is not None:
        for i in range(cut_row + 1, height):
            mirror_i = 2 * cut_row - i
            for j in range(width):
                input_list[i][j] = input_list[mirror_i][j]
        return input_list
    
    return input_list
