# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 8e92e77a
Difficulty: easy

=== Tags ===
- Draw line from point
- Connect the dots
- Portals
- Repaint border

=== Description ===
The task involves transforming an input grid into an output grid by connecting
two portal points with a straight line and repainting the grid's border. The
input grid contains exactly two distinct cells of a specific color (the
portals), positioned anywhere within the grid. The output grid must draw a
straight horizontal, vertical, or diagonal line (using a new, distinct color not
present in the input) between these two portal cells. Additionally, all cells
along the grid's outer perimeter (first row, last row, first column, last
column) must be repainted to a third distinct color, overriding any existing
colors in those border cells. The line is drawn using the shortest path between
the portals (e.g., horizontal, vertical, or diagonal), and the border repaint
affects all edge cells regardless of their original state. The transformation is
deterministic, relying solely on the positions of the portals and the grid
dimensions, with no dependency on other grid content or pixel-level patterns.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width = random.randint(2, 30)
    height = random.randint(2, 30)
    
    portal_type = random.choice(['horizontal', 'vertical', 'diagonal'])
    
    if portal_type == 'horizontal':
        r = random.randint(0, height-1)
        c1 = random.randint(0, width-1)
        c2 = random.randint(0, width-1)
        while c2 == c1:
            c2 = random.randint(0, width-1)
        r1, c1 = r, c1
        r2, c2 = r, c2
    elif portal_type == 'vertical':
        c = random.randint(0, width-1)
        r1 = random.randint(0, height-1)
        r2 = random.randint(0, height-1)
        while r2 == r1:
            r2 = random.randint(0, height-1)
        r1, c1 = r1, c
        r2, c2 = r2, c
    else:
        k = random.randint(1, min(height-1, width-1))
        dc = 1 if random.choice([True, False]) else -1
        r1 = random.randint(0, height - 1 - k)
        c1 = random.randint(0, width - 1 - k)
        if dc == -1:
            c1 = random.randint(k, width - 1)
        r2 = r1 + k
        c2 = c1 + dc * k
        
    A = random.randint(1, 9)
    input_grid = grid(width, height, 0)
    input_grid[r1][c1] = A
    input_grid[r2][c2] = A
    
    input_colors = set()
    for r in range(height):
        for c in range(width):
            input_colors.add(input_grid[r][c])
    
    available_colors = [color for color in range(10) if color not in input_colors]
    B = available_colors[0]
    C = available_colors[1]
    
    output_grid = grid(width, height, 0)
    for r in range(height):
        for c in range(width):
            if r == 0 or r == height-1 or c == 0 or c == width-1:
                output_grid[r][c] = C
    
    line_cells = []
    if r1 == r2:
        c_min = min(c1, c2)
        c_max = max(c1, c2)
        for c in range(c_min, c_max + 1):
            line_cells.append((r1, c))
    elif c1 == c2:
        r_min = min(r1, r2)
        r_max = max(r1, r2)
        for r in range(r_min, r_max + 1):
            line_cells.append((r, c1))
    else:
        dr = 1 if r2 > r1 else -1
        dc = 1 if c2 > c1 else -1
        steps = abs(r1 - r2)
        for i in range(steps + 1):
            r = r1 + dr * i
            c = c1 + dc * i
            line_cells.append((r, c))
    
    for (r, c) in line_cells:
        if r != 0 and r != height-1 and c != 0 and c != width-1:
            output_grid[r][c] = B
    
    return {'input': input_grid, 'output': output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

from common import grid

def p(input_grid):
    color_count = {}
    for r in range(len(input_grid)):
        for c in range(len(input_grid[0])):
            color = input_grid[r][c]
            color_count[color] = color_count.get(color, 0) + 1
    
    portal_color = None
    for color, count in color_count.items():
        if count == 2:
            portal_color = color
            break
    
    positions = []
    for r in range(len(input_grid)):
        for c in range(len(input_grid[0])):
            if input_grid[r][c] == portal_color:
                positions.append((r, c))
    (r1, c1), (r2, c2) = positions
    
    line_cells = []
    if r1 == r2:
        c_min = min(c1, c2)
        c_max = max(c1, c2)
        for c in range(c_min, c_max + 1):
            line_cells.append((r1, c))
    elif c1 == c2:
        r_min = min(r1, r2)
        r_max = max(r1, r2)
        for r in range(r_min, r_max + 1):
            line_cells.append((r, c1))
    else:
        dr = 1 if r2 > r1 else -1
        dc = 1 if c2 > c1 else -1
        steps = abs(r1 - r2)
        for i in range(steps + 1):
            r = r1 + dr * i
            c = c1 + dc * i
            line_cells.append((r, c))
    
    input_colors = set()
    for r in range(len(input_grid)):
        for c in range(len(input_grid[0])):
            input_colors.add(input_grid[r][c])
    
    available_colors = [color for color in range(10) if color not in input_colors]
    B = available_colors[0]
    C = available_colors[1]
    
    width = len(input_grid[0])
    height = len(input_grid)
    output_grid = grid(width, height, 0)
    
    for r in range(height):
        for c in range(width):
            if r == 0 or r == height-1 or c == 0 or c == width-1:
                output_grid[r][c] = C
    
    for (r, c) in line_cells:
        if r != 0 and r != height-1 and c != 0 and c != width-1:
            output_grid[r][c] = B
    
    return output_grid
