# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 2a844606
Difficulty: hard

=== Tags ===
- Rule propagation
- Cooperative rule network
- Reflect across detected axis

=== Description ===
Input grids contain a background color (0) and multiple foreground colors (1-9).
A specific foreground color forms a continuous, unbroken line spanning the
entire grid from one edge to the opposite edge (either horizontally across all
columns in a single row or vertically across all rows in a single column). This
line defines the reflection axis. The output grid is generated by reflecting the
input grid across this axis: for a horizontal axis, rows above the axis mirror
to rows below (e.g., row i mirrors to row (2*axis_row - i)), and for a vertical
axis, columns to the left mirror to columns to the right (e.g., column j mirrors
to column (2*axis_col - j)). The axis is uniquely determined by the continuous
edge-to-edge line of the specific color, with no other elements influencing its
detection. The transformation requires identifying the axis through the line's
continuity and edge-to-edge span, then applying the reflection rule. The
specific color used for the axis line is consistent across all examples but
remains hidden from the solver, requiring abstract reasoning to detect the axis
through the grid's structural properties.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
import common

def generate():
    axis_type = random.choice(['horizontal', 'vertical'])
    if axis_type == 'horizontal':
        height = random.randint(3, 30)
        width = random.randint(3, 30)
    else:
        width = random.randint(3, 30)
        height = random.randint(3, 30)
    input_grid = common.grid(width, height, 0)
    axis_color = common.random_color()
    if axis_type == 'horizontal':
        axis_pos = random.randint(1, height-2)
        for c in range(width):
            input_grid[axis_pos][c] = axis_color
    else:
        axis_pos = random.randint(1, width-2)
        for r in range(height):
            input_grid[r][axis_pos] = axis_color
    for r in range(height):
        for c in range(width):
            if (axis_type == 'horizontal' and r == axis_pos) or (axis_type == 'vertical' and c == axis_pos):
                continue
            if random.random() < 0.7:
                input_grid[r][c] = 0
            else:
                color = common.random_color(exclude=[axis_color])
                input_grid[r][c] = color
    if axis_type == 'horizontal':
        for r in range(height):
            if r == axis_pos:
                continue
            if all(x == input_grid[r][0] and input_grid[r][0] != 0 for x in input_grid[r]):
                return generate()
    else:
        for c in range(width):
            if c == axis_pos:
                continue
            col = [input_grid[r][c] for r in range(height)]
            if all(x == col[0] and col[0] != 0 for x in col):
                return generate()
    output_grid = [[0] * width for _ in range(height)]
    if axis_type == 'horizontal':
        for r in range(height):
            new_r = 2 * axis_pos - r
            if 0 <= new_r < height:
                output_grid[new_r] = input_grid[r][:]
            else:
                output_grid[r] = input_grid[r][:]
    else:
        for c in range(width):
            new_c = 2 * axis_pos - c
            if 0 <= new_c < width:
                for r in range(height):
                    output_grid[r][new_c] = input_grid[r][c]
            else:
                for r in range(height):
                    output_grid[r][c] = input_grid[r][c]
    if input_grid == output_grid:
        return generate()
    return {'input': input_grid, 'output': output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    height = len(grid)
    width = len(grid[0])
    axis_row = None
    for r in range(height):
        first = grid[r][0]
        if first != 0 and all(x == first for x in grid[r]):
            axis_row = r
            break
    axis_col = None
    for c in range(width):
        first = grid[0][c]
        if first != 0 and all(grid[r][c] == first for r in range(height)):
            axis_col = c
            break
    if axis_row is not None:
        output = [[0] * width for _ in range(height)]
        for r in range(height):
            new_r = 2 * axis_row - r
            if 0 <= new_r < height:
                output[new_r] = grid[r][:]
            else:
                output[r] = grid[r][:]
        return output
    elif axis_col is not None:
        output = [[0] * width for _ in range(height)]
        for c in range(width):
            new_c = 2 * axis_col - c
            if 0 <= new_c < width:
                for r in range(height):
                    output[r][new_c] = grid[r][c]
            else:
                for r in range(height):
                    output[r][c] = grid[r][c]
        return output
    return input_grid
