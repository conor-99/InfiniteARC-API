# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: 606bb4d8
Difficulty: medium

=== Tags ===
- Associate images to patterns

=== Description ===
The task involves transforming input grids by rotating all straight horizontal
line segments into vertical line segments and vice versa, while maintaining
their length and color. For each horizontal line segment (a contiguous sequence
of the same color in a single row), the output replaces it with a vertical line
segment of identical length and color, centered at the original segment's
midpoint. Similarly, vertical line segments are replaced with horizontal
segments. Non-linear structures (such as squares, L-shapes, or diagonal lines)
remain unchanged in the output grid. This requires recognizing line orientations
and applying a consistent rotation based on visual arrangement rather than
numerical properties.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, random_color

def generate():
    width = random.randint(3, 30)
    height = random.randint(3, 30)
    grid_input = grid(width, height, 0)
    
    # Add horizontal segments
    for _ in range(random.randint(1, 3)):
        color = random_color()
        L = random.choice([3, 5])
        # Ensure L fits horizontally
        if L > width:
            continue
        r_min = (L - 1) // 2
        r_max = height - 1 - (L - 1) // 2
        if r_min > r_max:
            continue
        r = random.randint(r_min, r_max)
        c_start = random.randint(0, width - L)
        for c in range(c_start, c_start + L):
            grid_input[r][c] = color
    
    # Add vertical segments
    for _ in range(random.randint(1, 3)):
        color = random_color()
        L = random.choice([3, 5])
        # Ensure L fits vertically
        if L > height:
            continue
        c_min = (L - 1) // 2
        c_max = width - 1 - (L - 1) // 2
        if c_min > c_max:
            continue
        c = random.randint(c_min, c_max)
        r_start = random.randint(0, height - L)
        for r in range(r_start, r_start + L):
            grid_input[r][c] = color
    
    grid_output = grid(width, height, 0)
    
    # Transform horizontal segments
    for r in range(height):
        c = 0
        while c < width:
            if grid_input[r][c] != 0:
                color = grid_input[r][c]
                c_end = c
                while c_end < width and grid_input[r][c_end] == color:
                    c_end += 1
                L = c_end - c
                if L >= 3 and L % 2 == 1:
                    c_mid = c + (L - 1) // 2
                    top = r - (L - 1) // 2
                    bottom = r + (L - 1) // 2
                    for i in range(top, bottom + 1):
                        if 0 <= i < height:
                            grid_output[i][c_mid] = color
                c = c_end
            else:
                c += 1
    
    # Transform vertical segments
    for c in range(width):
        r = 0
        while r < height:
            if grid_input[r][c] != 0:
                color = grid_input[r][c]
                r_end = r
                while r_end < height and grid_input[r_end][c] == color:
                    r_end += 1
                L = r_end - r
                if L >= 3 and L % 2 == 1:
                    r_mid = r + (L - 1) // 2
                    left = c - (L - 1) // 2
                    right = c + (L - 1) // 2
                    for i in range(left, right + 1):
                        if 0 <= i < width:
                            grid_output[r_mid][i] = color
                r = r_end
            else:
                r += 1
    
    return {
        "input": grid_input,
        "output": grid_output
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

from common import grid

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = grid(width, height, 0)
    
    # Transform horizontal segments
    for r in range(height):
        c = 0
        while c < width:
            if input_grid[r][c] != 0:
                color = input_grid[r][c]
                c_end = c
                while c_end < width and input_grid[r][c_end] == color:
                    c_end += 1
                L = c_end - c
                if L >= 3 and L % 2 == 1:
                    c_mid = c + (L - 1) // 2
                    top = r - (L - 1) // 2
                    bottom = r + (L - 1) // 2
                    for i in range(top, bottom + 1):
                        if 0 <= i < height:
                            output_grid[i][c_mid] = color
                c = c_end
            else:
                c += 1
    
    # Transform vertical segments
    for c in range(width):
        r = 0
        while r < height:
            if input_grid[r][c] != 0:
                color = input_grid[r][c]
                r_end = r
                while r_end < height and input_grid[r_end][c] == color:
                    r_end += 1
                L = r_end - r
                if L >= 3 and L % 2 == 1:
                    r_mid = r + (L - 1) // 2
                    left = c - (L - 1) // 2
                    right = c + (L - 1) // 2
                    for i in range(left, right + 1):
                        if 0 <= i < width:
                            output_grid[r_mid][i] = color
                r = r_end
            else:
                r += 1
    
    return output_grid
