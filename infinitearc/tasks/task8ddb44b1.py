# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: 8ddb44b1
Difficulty: medium–hard

=== Tags ===
- Guided flow
- Pattern translation
- Color particle emission
- Multi object alignment
- Swap rows

=== Description ===
The input grid consists of a background (0) and colored particles (1–9), where
each color corresponds to a fixed movement direction: color 1 moves right, color
2 moves left, color 3 moves up, color 4 moves down, color 5 moves right, color 6
moves left, color 7 moves up, color 8 moves down, and color 9 moves right. Each
particle moves exactly one cell in its direction if the target cell is
background (0); otherwise, it remains in place. After all particles have moved,
the grid undergoes a row swap operation: rows containing particles of color 3
are swapped with rows containing particles of color 7. If multiple rows contain
color 3 or 7, the swaps are performed in order from top to bottom (e.g., the
topmost color 3 row swaps with the topmost color 7 row, followed by the next
pair). This alignment ensures that color 3 and 7 particles are positioned
relative to each other, creating a visual pattern of guided flow through the
grid. The transformation maintains all background cells and focuses on the
movement and alignment of particles based on their color-coded directions.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
import random

def generate():
    directions = {
        1: (0, 1),
        2: (0, -1),
        3: (-1, 0),
        4: (1, 0),
        5: (0, 1),
        6: (0, -1),
        7: (-1, 0),
        8: (1, 0),
        9: (0, 1)
    }
    while True:
        width = random.randint(1, 30)
        height = random.randint(1, 30)
        input_grid = common.grid(width, height, 0)
        target_cells = set()
        for _ in range(random.randint(0, 15)):
            r = random.randint(0, height-1)
            c = random.randint(0, width-1)
            color = random.randint(1, 9)
            dr, dc = directions[color]
            target_r = r + dr
            target_c = c + dc
            if 0 <= target_r < height and 0 <= target_c < width and input_grid[target_r][target_c] == 0:
                input_grid[r][c] = color
                target_cells.add((target_r, target_c))
        intermediate = common.grid(width, height, 0)
        for r in range(height):
            for c in range(width):
                if input_grid[r][c] > 0:
                    color = input_grid[r][c]
                    dr, dc = directions[color]
                    target_r = r + dr
                    target_c = c + dc
                    if 0 <= target_r < height and 0 <= target_c < width and input_grid[target_r][target_c] == 0:
                        intermediate[target_r][target_c] = color
                    else:
                        intermediate[r][c] = input_grid[r][c]
        color3_rows = []
        color7_rows = []
        for r in range(height):
            if 3 in intermediate[r]:
                color3_rows.append(r)
            if 7 in intermediate[r]:
                color7_rows.append(r)
        if len(color3_rows) != len(color7_rows):
            continue
        color3_rows.sort()
        color7_rows.sort()
        output_grid = [row[:] for row in intermediate]
        for i in range(len(color3_rows)):
            r3 = color3_rows[i]
            r7 = color7_rows[i]
            output_grid[r3], output_grid[r7] = output_grid[r7], output_grid[r3]
        if input_grid == output_grid:
            continue
        return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

import common

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    directions = {
        1: (0, 1),
        2: (0, -1),
        3: (-1, 0),
        4: (1, 0),
        5: (0, 1),
        6: (0, -1),
        7: (-1, 0),
        8: (1, 0),
        9: (0, 1)
    }
    intermediate = common.grid(width, height, 0)
    for r in range(height):
        for c in range(width):
            color = input_grid[r][c]
            if color == 0:
                continue
            dr, dc = directions[color]
            target_r = r + dr
            target_c = c + dc
            if 0 <= target_r < height and 0 <= target_c < width and input_grid[target_r][target_c] == 0:
                intermediate[target_r][target_c] = color
            else:
                intermediate[r][c] = color
    color3_rows = []
    color7_rows = []
    for r in range(height):
        if 3 in intermediate[r]:
            color3_rows.append(r)
        if 7 in intermediate[r]:
            color7_rows.append(r)
    color3_rows.sort()
    color7_rows.sort()
    output_grid = [row[:] for row in intermediate]
    for i in range(len(color3_rows)):
        r3 = color3_rows[i]
        r7 = color7_rows[i]
        output_grid[r3], output_grid[r7] = output_grid[r7], output_grid[r3]
    return output_grid
