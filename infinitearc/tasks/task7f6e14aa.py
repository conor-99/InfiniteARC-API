# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-04
# ---------------------------------------------------------------

"""
Task ID: 7f6e14aa
Difficulty: hard

=== Tags ===
- Dynamic environment
- Associate images to patterns
- Wraparound copy

=== Description ===
Input grids contain a single, isolated visual pattern formed by a unique color
(e.g., color 5), which appears only once in the entire grid. This pattern is a
geometric shape (e.g., horizontal line, vertical line, diagonal line, or
arrowhead) that is distinct from all other elements. The orientation of this
pattern determines the direction of a wraparound copy operation applied to the
entire grid. A horizontal pattern (e.g., left-to-right line) indicates a
rightward shift, a vertical pattern (top-to-bottom line) indicates a downward
shift, and a diagonal pattern (top-left to bottom-right line) indicates a
diagonal shift (right and down). The output grid is generated by shifting every
cell in the input grid in the determined direction by one cell, with the grid
wrapping around at all edges (e.g., the rightmost column moves to the leftmost
position when shifting right). The unique pattern remains visible in the output
as part of the transformed grid. The transformation requires identifying the
pattern's orientation through visual analysis and applying the correct
wraparound shift, making it a hard task due to the need for precise pattern
recognition and directional reasoning.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, randint, random_color
def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    color = random_color(exclude=[0])
    grid_in = grid(width, height, 0)
    
    pattern_type = random.choice(['horizontal', 'vertical', 'diagonal'])
    
    if pattern_type == 'horizontal':
        r = random.randint(1, height - 2)
        c_start = random.randint(1, width - 3)
        for c in range(c_start, c_start + 3):
            grid_in[r][c] = color
    elif pattern_type == 'vertical':
        c = random.randint(1, width - 2)
        r_start = random.randint(1, height - 3)
        for r in range(r_start, r_start + 3):
            grid_in[r][c] = color
    else:  # diagonal
        r_start = random.randint(1, height - 3)
        c_start = random.randint(1, width - 3)
        for i in range(3):
            grid_in[r_start + i][c_start + i] = color
    
    grid_out = [[0] * width for _ in range(height)]
    if pattern_type == 'horizontal':
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[i][(j - 1) % width]
    elif pattern_type == 'vertical':
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[(i - 1) % height][j]
    else:  # diagonal
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[(i - 1) % height][(j - 1) % width]
    
    return {'input': grid_in, 'output': grid_out}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid_in = [list(row) for row in input_grid]
    width = len(grid_in[0])
    height = len(grid_in)
    
    non_zero_colors = set()
    for row in grid_in:
        for val in row:
            if val != 0:
                non_zero_colors.add(val)
    color = next(iter(non_zero_colors))
    
    positions = []
    for i in range(height):
        for j in range(width):
            if grid_in[i][j] == color:
                positions.append((i, j))
    
    rows = [pos[0] for pos in positions]
    cols = [pos[1] for pos in positions]
    if all(r == rows[0] for r in rows):
        shift_type = 'horizontal'
    elif all(c == cols[0] for c in cols):
        shift_type = 'vertical'
    else:
        diffs = [j - i for i, j in positions]
        if all(d == diffs[0] for d in diffs):
            shift_type = 'diagonal'
        else:
            shift_type = 'diagonal'
    
    grid_out = [[0] * width for _ in range(height)]
    if shift_type == 'horizontal':
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[i][(j - 1) % width]
    elif shift_type == 'vertical':
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[(i - 1) % height][j]
    else:  # diagonal
        for i in range(height):
            for j in range(width):
                grid_out[i][j] = grid_in[(i - 1) % height][(j - 1) % width]
    
    return grid_out
