# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: d77b3c98
Difficulty: easy

=== Tags ===
- Threshold by area

=== Description ===
The task involves analyzing 2D grids where each cell contains a color value
between 0 and 9. The transformation rule is based on the area of connected
regions (4-connected, meaning adjacent horizontally or vertically). For every
connected region in the input grid, if the number of cells (area) is 3 or
greater, all cells in that region are replaced with color 5 in the output grid.
Regions with fewer than 3 cells remain unchanged. The output grid reflects these
replacements, making the transformation visually apparent through the consistent
replacement of larger regions while preserving smaller ones. This rule requires
identifying connected components by area rather than relying on numerical
properties, ensuring the task is solvable through visual pattern recognition.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
from common import grid, continuous_creature, randint

def generate():
    width = randint(3, 10)
    height = randint(3, 10)
    input_grid = grid(width, height, 4)
    color2 = 2
    color3 = 3

    region2 = continuous_creature(3, width, height)
    for r, c in region2:
        input_grid[r][c] = color2

    region3 = []
    attempts = 0
    while len(region3) < 2 and attempts < 10:
        region3 = continuous_creature(2, width, height)
        if any((r, c) in region2 for r, c in region3):
            region3 = []
        attempts += 1
    if len(region3) < 2:
        region3 = [(0, 0), (0, 1)]
    for r, c in region3:
        input_grid[r][c] = color3

    visited = [[False] * width for _ in range(height)]
    output_grid = grid(width, height, 0)
    for r in range(height):
        for c in range(width):
            if not visited[r][c]:
                color = input_grid[r][c]
                component = []
                queue = [(r, c)]
                visited[r][c] = True
                while queue:
                    cr, cc = queue.pop(0)
                    component.append((cr, cc))
                    for dr, dc in [(1,0), (-1,0), (0,1), (0,-1)]:
                        nr, nc = cr + dr, cc + dc
                        if 0 <= nr < height and 0 <= nc < width and not visited[nr][nc] and input_grid[nr][nc] == color:
                            visited[nr][nc] = True
                            queue.append((nr, nc))
                if len(component) >= 3:
                    for cr, cc in component:
                        output_grid[cr][cc] = 5
                else:
                    for cr, cc in component:
                        output_grid[cr][cc] = color
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    visited = [[False] * width for _ in range(height)]
    output_grid = [[0] * width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            if not visited[r][c]:
                color = input_grid[r][c]
                component = []
                queue = [(r, c)]
                visited[r][c] = True
                while queue:
                    cr, cc = queue.pop(0)
                    component.append((cr, cc))
                    for dr, dc in [(1,0), (-1,0), (0,1), (0,-1)]:
                        nr, nc = cr + dr, cc + dc
                        if 0 <= nr < height and 0 <= nc < width and not visited[nr][nc] and input_grid[nr][nc] == color:
                            visited[nr][nc] = True
                            queue.append((nr, nc))
                size = len(component)
                if size >= 3:
                    for cr, cc in component:
                        output_grid[cr][cc] = 5
                else:
                    for cr, cc in component:
                        output_grid[cr][cc] = color
    return output_grid
