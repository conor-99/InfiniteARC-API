# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 158ab52b
Difficulty: hard

=== Tags ===
- Conditional draw
- Color majority column
- Grid coloring

=== Description ===
**Task Description:**  Input grids are rectangular arrangements of cells with
dimensions ranging from 3×3 to 30×30. Each cell contains an integer value
between 0 (background) and 9 (color), representing distinct visual elements. The
background (0) is transparent and does not contribute to color analysis.  For
each column in the input grid, determine the **majority color**—the non-zero
color that appears most frequently in that column (ignoring background cells).
If two or more non-zero colors tie for the highest frequency, the column is
considered to have **no majority**.  The output grid is constructed by: -
**Homogenizing columns with a strict majority**: Every cell in the column is
replaced with the majority color. - **Resetting tied columns**: Every cell in
the column is set to background (0).  This transformation applies independently
to every column. Columns with a strict majority become solid blocks of their
majority color, while tied columns collapse into background. The output grid
will always differ from the input because: - Columns with a strict majority
change from varied colors to a single color. - Tied columns change from varied
colors to background (0).  The task requires identifying column-wise color
frequencies, resolving ties, and applying the homogenization rule without
overwriting non-background elements. The complexity arises from the need to
process each column's color distribution independently while maintaining visual
consistency across the grid.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, random_color

def generate():
    width = random.randint(3, 30)
    height = random.randint(3, 30)
    input_grid = grid(width, height, 0)
    
    for c in range(width):
        if random.choice([True, False]):
            # Strict majority
            majority_color = random_color(exclude=[0])
            count_majority = random.randint(2, height - 1)
            indices = random.sample(range(height), count_majority)
            for r in indices:
                input_grid[r][c] = majority_color
            remaining = [r for r in range(height) if r not in indices]
            for r in remaining:
                color = random_color(exclude=[0, majority_color])
                input_grid[r][c] = color
        else:
            # Tied column
            color1 = random_color(exclude=[0])
            color2 = random_color(exclude=[0, color1])
            count = random.randint(1, height // 2)
            indices1 = random.sample(range(height), count)
            for r in indices1:
                input_grid[r][c] = color1
            indices2 = random.sample([r for r in range(height) if r not in indices1], count)
            for r in indices2:
                input_grid[r][c] = color2
    
    output_grid = grid(width, height, 0)
    for c in range(width):
        counts = {}
        for r in range(height):
            color = input_grid[r][c]
            if color != 0:
                counts[color] = counts.get(color, 0) + 1
        if not counts:
            continue
        max_count = max(counts.values())
        majority_colors = [color for color, count in counts.items() if count == max_count]
        if len(majority_colors) == 1:
            majority_color = majority_colors[0]
            for r in range(height):
                output_grid[r][c] = majority_color
    
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    width = len(grid[0])
    height = len(grid)
    
    for c in range(width):
        counts = {}
        for r in range(height):
            color = grid[r][c]
            if color != 0:
                counts[color] = counts.get(color, 0) + 1
        if not counts:
            continue
        max_count = max(counts.values())
        majority_colors = [color for color, count in counts.items() if count == max_count]
        if len(majority_colors) == 1:
            majority_color = majority_colors[0]
            for r in range(height):
                grid[r][c] = majority_color
        else:
            for r in range(height):
                grid[r][c] = 0
    
    return tuple(tuple(row) for row in grid)
