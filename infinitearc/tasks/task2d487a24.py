# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 2d487a24
Difficulty: hard

=== Tags ===
- Pattern sync
- Rule composition
- Chain reaction
- Color by distance to edge

=== Description ===
Input grids are medium to large (15×15 to 30×30) with a single background color
(0) and multiple disjoint connected regions of solid non-background colors
(1–9). Each region forms a continuous path (e.g., spiral, zigzag) that does not
touch the grid edges. A horizontal "pattern strip" of 3–5 distinct non-
background colors (1–9) is positioned at the top-right corner, forming a visible
sequence. The output grid transforms each cell within the connected regions by
replacing its color with the pattern strip's color at an index determined by the
cell's distance to the nearest grid edge. Distance is calculated as the minimum
of the cell's row position, vertical distance to the bottom edge, column
position, and horizontal distance to the right edge. The pattern strip's
sequence cycles repeatedly to map distance values (e.g., distance 0 → first
strip color, distance 1 → second, etc.). Background cells and all cells in the
pattern strip remain unchanged. The transformation requires identifying the
pattern strip, calculating edge distances for each region cell, and
synchronizing the color sequence with the distance-based index, creating a chain
of visual color transitions across the grid that align with the input's pattern.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, continuous_creature, random_color

def generate():
    width = random.randint(15, 30)
    height = random.randint(15, 30)
    input_grid = grid(width, height, 0)
    
    k = random.randint(3, 5)
    start_col = width - k
    pattern_strip = []
    for c in range(start_col, width):
        color = random_color(exclude=pattern_strip)
        pattern_strip.append(color)
        input_grid[0][c] = color
    
    interior_width = width - 2
    interior_height = height - 2
    regions = []
    max_regions = random.randint(1, 3)
    for _ in range(max_regions):
        color = random_color(exclude=pattern_strip)
        while True:
            size = random.randint(5, 20)
            creature = continuous_creature(size, width=interior_width, height=interior_height)
            shifted_creature = [(r+1, c+1) for r, c in creature]
            overlap = any((r, c) in regions for r, c in shifted_creature)
            if not overlap:
                break
        for r, c in shifted_creature:
            input_grid[r][c] = color
        regions.append(shifted_creature)
    
    output_grid = [row[:] for row in input_grid]
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] != 0 and r != 0:
                d = min(r, height-1 - r, c, width-1 - c)
                idx = d % len(pattern_strip)
                output_grid[r][c] = pattern_strip[idx]
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    h = len(grid)
    w = len(grid[0])
    
    strip = []
    for c in range(w-1, -1, -1):
        if grid[0][c] == 0:
            break
        strip.append(grid[0][c])
    strip = strip[::-1]
    
    for r in range(h):
        for c in range(w):
            if grid[r][c] != 0 and r != 0:
                d = min(r, h-1 - r, c, w-1 - c)
                idx = d % len(strip)
                grid[r][c] = strip[idx]
    
    return tuple(tuple(row) for row in grid)
