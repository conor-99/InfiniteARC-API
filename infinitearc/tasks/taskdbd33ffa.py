# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: dbd33ffa
Difficulty: mediumâ€“hard

=== Tags ===
- Directional routing
- Assemble from parts
- Beam reflection
- Connect equal color components

=== Description ===
Input grids feature a background color (0) and multiple colored regions (1-9),
each region consisting of one or more connected components (4-directionally
adjacent cells of the same color). The grids also contain mirror cells,
represented by a distinct color (e.g., color 9), which reflect beams at
90-degree angles. The output grid must connect all disconnected components of
each color into a single continuous path using straight-line segments and
reflections off mirror cells. Beams travel in cardinal directions (up, down,
left, right), changing direction 90 degrees upon hitting a mirror (e.g., right-
moving beam becomes upward after hitting a mirror). Paths must not overlap with
other colors, mirror cells (except at reflection points), or the background.
Each color's path must fully connect all its components, with reflections used
to navigate around obstacles. Grids require multiple reflections for complex
color connections, with paths extending only through background cells.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
import common

def generate():
    width = random.randint(10, 20)
    height = random.randint(10, 20)
    grid = common.grid(width, height, 0)
    colors = sorted(random.sample(range(1, 9), 3))
    
    for c in colors:
        for _ in range(2):
            r = random.randint(0, height-1)
            c_pos = random.randint(0, width-1)
            for dr in [-1, 0, 1]:
                for dc in [-1, 0, 1]:
                    nr, nc = r + dr, c_pos + dc
                    if 0 <= nr < height and 0 <= nc < width:
                        if grid[nr][nc] == 0:
                            grid[nr][nc] = c
    
    mid_r, mid_c = height // 2, width // 2
    grid[mid_r][mid_c] = 0  # Ensure center is background
    grid[mid_r][mid_c] = 9  # Place mirror
    
    output = [row[:] for row in grid]
    
    for c in colors:
        positions = []
        for r in range(height):
            for c_idx in range(width):
                if grid[r][c_idx] == c:
                    positions.append((r, c_idx))
        if len(positions) >= 2:
            (r1, c1), (r2, c2) = positions[:2]
            mirror_r, mirror_c = mid_r, mid_c
            
            for x in range(min(c1, mirror_c), max(c1, mirror_c) + 1):
                if output[r1][x] == 0:
                    output[r1][x] = c
            for y in range(min(r1, mirror_r), max(r1, mirror_r) + 1):
                if output[y][mirror_c] == 0:
                    output[y][mirror_c] = c
            for x in range(min(mirror_c, c2), max(mirror_c, c2) + 1):
                if output[mirror_r][x] == 0:
                    output[mirror_r][x] = c
            for y in range(min(mirror_r, r2), max(mirror_r, r2) + 1):
                if output[y][c2] == 0:
                    output[y][c2] = c
    
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    width = len(input_grid[0])
    height = len(input_grid)
    output = [row[:] for row in input_grid]
    
    for color in range(1, 9):
        positions = []
        for r in range(height):
            for c in range(width):
                if input_grid[r][c] == color:
                    positions.append((r, c))
        if len(positions) < 2:
            continue
        
        mirror_r, mirror_c = None, None
        for r in range(height):
            for c in range(width):
                if input_grid[r][c] == 9:
                    mirror_r, mirror_c = r, c
                    break
            if mirror_r is not None:
                break
        
        if mirror_r is None:
            continue
        
        (r1, c1), (r2, c2) = positions[0], positions[1]
        
        for x in range(min(c1, mirror_c), max(c1, mirror_c) + 1):
            if output[r1][x] == 0:
                output[r1][x] = color
        for y in range(min(r1, mirror_r), max(r1, mirror_r) + 1):
            if output[y][mirror_c] == 0:
                output[y][mirror_c] = color
        for x in range(min(mirror_c, c2), max(mirror_c, c2) + 1):
            if output[mirror_r][x] == 0:
                output[mirror_r][x] = color
        for y in range(min(mirror_r, r2), max(mirror_r, r2) + 1):
            if output[y][c2] == 0:
                output[y][c2] = color
    
    return output
