# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: 79afd37f
Difficulty: hard

=== Tags ===
- Axis inference
- Color guessing

=== Description ===
The input grid is a 2D array of integers between 0 and 9, representing colors.
The transformation requires inferring the correct vertical axis of symmetry by
analyzing which column position maximizes the number of matching color pairs
when the grid is reflected across that axis. The axis is determined by checking
all possible vertical columns (from left to right) and selecting the one where
the left and right sides align most consistently in color. Once the axis is
identified, the output grid is generated by reflecting each cell across this
axis—meaning the color at position (r, c) in the input is placed at (r, axis -
(c - axis)) in the output. This process demands both axis inference (determining
the optimal column for reflection) and color guessing (ensuring reflected colors
match the required symmetry, even if the input contains mismatches). The task is
hard because the axis is not fixed (e.g., not always the center column) and must
be deduced from subtle patterns in the input’s color distribution.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    while True:
        width = random.randint(1, 30)
        width = width if width % 2 == 1 else width - 1
        if width < 1:
            width = 1
        height = random.randint(1, 30)
        axis = width // 2
        input_grid = [[0] * width for _ in range(height)]
        for r in range(height):
            for c in range(axis):
                if random.random() > 0.05:  # 95% chance to match
                    color = random.randint(1, 9)
                    input_grid[r][c] = color
                    input_grid[r][2*axis - c] = color
                else:
                    color1 = random.randint(1, 9)
                    color2 = random.randint(1, 9)
                    while color2 == color1:
                        color2 = random.randint(1, 9)
                    input_grid[r][c] = color1
                    input_grid[r][2*axis - c] = color2
            input_grid[r][axis] = random.randint(1, 9)
        output_grid = [[0] * width for _ in range(height)]
        for r in range(height):
            for c in range(width):
                reflected_c = 2 * axis - c
                output_grid[r][c] = input_grid[r][reflected_c]
        if input_grid != output_grid:
            break
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    best_axis = 0
    max_matches = -1
    for c in range(width):
        matches = 0
        for r in range(height):
            for c_in in range(width):
                c_out = 2*c - c_in
                if c_out < 0 or c_out >= width:
                    continue
                if input_grid[r][c_in] == input_grid[r][c_out]:
                    matches += 1
        if matches > max_matches:
            max_matches = matches
            best_axis = c
    output_grid = [[0] * width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            reflected_c = 2 * best_axis - c
            output_grid[r][c] = input_grid[r][reflected_c]
    return output_grid
