# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 441c5038
Difficulty: insane

=== Tags ===
- Color stream
- Multi layer projection
- Echo trail
- Pattern coloring

=== Description ===
The input grid features a single colored token positioned along the left edge of
the grid, facing right, on a uniform background. Scattered across the grid is a
distinct color streamâ€”a horizontal sequence of colors (e.g., red, blue, green)
that defines the sequence for trail coloring. The token moves cell-by-cell in
its initial direction until it exits the grid, leaving a primary trail where
each cell is colored using the next color in the stream, cycling through the
sequence as needed. Concurrently, for each cell in the primary trail, an echo
trail is generated vertically (up and down) using a derived color sequence: the
color for the echo is the next color in the stream after the primary trail's
color. The echo trail consists of single cells directly above and below each
primary trail cell, colored according to this derived sequence. The background
remains unchanged, and trails are drawn only on background cells, preserving the
grid's original structure. The transformation requires simultaneous application
of the color stream sequence for primary trails, sequential offset for echo
trails, and precise placement of both layers without overlap.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    grid = [[0] * width for _ in range(height)]
    
    r = random.randint(1, height - 2)
    grid[r][0] = 1
    
    stream_length = random.randint(2, 5)
    color_stream = []
    used_colors = [0, 1]
    for _ in range(stream_length):
        color = random.randint(2, 9)
        while color in used_colors:
            color = random.randint(2, 9)
        color_stream.append(color)
        used_colors.append(color)
    
    s = r + 2
    if s >= height:
        s = r - 2
    if s < 0:
        s = r + 2
    start_col = random.randint(0, width - stream_length)
    for i in range(stream_length):
        grid[s][start_col + i] = color_stream[i]
    
    output = [row[:] for row in grid]
    for c in range(width):
        output[r][c] = color_stream[c % stream_length]
        if r - 1 >= 0 and grid[r - 1][c] == 0:
            output[r - 1][c] = color_stream[(c + 1) % stream_length]
        if r + 1 < height and grid[r + 1][c] == 0:
            output[r + 1][c] = color_stream[(c + 1) % stream_length]
    
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    width = len(grid[0])
    height = len(grid)
    
    r = None
    for i in range(height):
        if grid[i][0] == 1:
            r = i
            break
    if r is None:
        return grid
    
    stream = []
    for i in range(height):
        for j in range(width - 1):
            if grid[i][j] != 0 and grid[i][j] != 1 and grid[i][j + 1] != 0 and grid[i][j + 1] != 1:
                stream = []
                k = j
                while k < width and grid[i][k] != 0 and grid[i][k] != 1:
                    stream.append(grid[i][k])
                    k += 1
                break
        if stream:
            break
    
    if not stream:
        stream = [2, 3, 4]
    
    output = [row[:] for row in grid]
    for c in range(width):
        primary = stream[c % len(stream)]
        echo = stream[(c + 1) % len(stream)]
        output[r][c] = primary
        if r - 1 >= 0 and grid[r - 1][c] == 0:
            output[r - 1][c] = echo
        if r + 1 < height and grid[r + 1][c] == 0:
            output[r + 1][c] = echo
    
    return output
