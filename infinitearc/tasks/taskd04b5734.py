# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-03
# ---------------------------------------------------------------

"""
Task ID: d04b5734
Difficulty: hard

=== Tags ===
- Associate images to patterns
- Recoloring
- One yes one no
- Pattern alignment

=== Description ===
The task involves input grids containing T-shaped patterns formed by a single
color. Each T pattern consists of a vertical stem (at least 3 cells tall) with a
horizontal bar centered on the stem (at least 3 cells wide). The transformation
rule requires identifying all such T patterns and recoloring them to a new color
(e.g., color 5) *only if* the horizontal bar is perfectly centered within the
grid's width. If the horizontal bar is misaligned (not centered), the T pattern
remains unchanged. The "one yes one no" aspect refers to each T pattern being
evaluated as either "yes" (centered, recolored) or "no" (misaligned, unchanged).
"Associate images to patterns" is satisfied by linking the T-shape to the
recoloring rule, while "Pattern alignment" mandates checking the horizontal
bar's positional alignment relative to the grid's center. The rule must be
applied consistently across all T patterns in the input grid, making the
solution require both pattern detection and spatial reasoning.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    W = random.choice([i for i in range(5, 30, 2)])
    H = random.randint(4, 30)
    grid_in = grid(W, H, 0)
    num_ts = random.randint(1, 3)
    for i in range(num_ts):
        is_yes = (i == 0)
        if i > 0:
            is_yes = random.choice([True, False])
        color = random.choice([i for i in range(1, 10) if i != 5])
        center = (W - 1) // 2
        r = random.randint(0, H - 4)
        if is_yes:
            for c in [center-1, center, center+1]:
                if 0 <= c < W:
                    grid_in[r][c] = color
            for i in range(1, 4):
                if 0 <= r + i < H:
                    grid_in[r + i][center] = color
        else:
            other_center = random.choice([i for i in range(W) if i != center])
            for c in [other_center-1, other_center, other_center+1]:
                if 0 <= c < W:
                    grid_in[r][c] = color
            for i in range(1, 4):
                if 0 <= r + i < H:
                    grid_in[r + i][other_center] = color
    grid_out = [row[:] for row in grid_in]
    for r in range(H):
        for c in range(W):
            if c > 0 and c < W-1 and grid_in[r][c] != 0 and grid_in[r][c-1] == grid_in[r][c] == grid_in[r][c+1]:
                if r < H-3 and grid_in[r+1][c] == grid_in[r][c] and grid_in[r+2][c] == grid_in[r][c] and grid_in[r+3][c] == grid_in[r][c]:
                    if c == center:
                        for i in range(3):
                            grid_out[r][c-1 + i] = 5
                        for i in range(1, 4):
                            grid_out[r + i][c] = 5
    return {"input": grid_in, "output": grid_out}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    # Ensure input_grid is list of lists (not tuple)
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    H = len(input_grid)
    W = len(input_grid[0])
    center = (W - 1) // 2
    output_grid = [row[:] for row in input_grid]
    for r in range(H):
        for c in range(W):
            if c > 0 and c < W-1 and input_grid[r][c] != 0 and input_grid[r][c-1] == input_grid[r][c] == input_grid[r][c+1]:
                if r < H-3 and input_grid[r+1][c] == input_grid[r][c] and input_grid[r+2][c] == input_grid[r][c] and input_grid[r+3][c] == input_grid[r][c]:
                    if c == center:
                        for i in range(3):
                            output_grid[r][c-1 + i] = 5
                        for i in range(1, 4):
                            output_grid[r + i][c] = 5
    return output_grid
