# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: c410834e
Difficulty: insane

=== Tags ===
- Rectangle guessing
- Fractal repetition
- Detect repetition
- Color matching

=== Description ===
The task involves input grids containing multiple non-overlapping, axis-aligned
rectangles, each filled with a distinct color. The output grid is created by
subdividing each rectangle into a 2x2 grid of smaller rectangles of the same
color, maintaining the original rectangle's boundaries. This fractal repetition
requires detecting each rectangle's precise boundaries and applying the
subdivision uniformly. The challenge is to correctly identify all rectangles
amidst complex color patterns and apply the subdivision without altering colors
or positions.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid, random_colors

def generate():
    width = random.randint(4, 30)
    height = random.randint(4, 30)
    colors = random_colors(random.randint(2, 5), exclude=[0])
    input_grid = grid(width, height, 0)
    output_grid = grid(width, height, 0)
    
    for color in colors:
        rect_width = random.randint(2, width // 2) * 2
        rect_height = random.randint(2, height // 2) * 2
        x = random.randint(0, width - rect_width)
        y = random.randint(0, height - rect_height)
        
        for r in range(y, y + rect_height):
            for c in range(x, x + rect_width):
                input_grid[r][c] = color
                output_grid[r][c] = (color + 1) % 9 or 1
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    output_grid = [row[:] for row in input_grid]
    for r in range(len(input_grid)):
        for c in range(len(input_grid[0])):
            if input_grid[r][c] > 0:
                value = (input_grid[r][c] + 1) % 9
                output_grid[r][c] = value if value != 0 else 1
    return output_grid
