# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 7b40f5e8
Difficulty: medium

=== Tags ===
- Select every nth row
- Connect equal color components
- Take half

=== Description ===
The task transforms an input grid by first selecting every second row (i.e.,
keeping rows at even indices), reducing the grid's height by half. Then, for
each color present in the resulting grid, any disconnected regions of that color
are connected by filling the gaps between them with the same color, ensuring all
instances of a color form a single contiguous region. This results in an output
grid that is half the height of the input, with all color components fully
connected. The transformation requires identifying disconnected regions of the
same color and merging them through visual connectivity, without relying on
numerical properties or pixel-level matching.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

def generate():
    import random
    width = random.randint(2, 30)
    intermediate_height = random.randint(1, 15)
    input_height = 2 * intermediate_height
    color_c = random.randint(1, 9)
    intermediate = []
    for _ in range(intermediate_height):
        row = [0] * width
        row[0] = color_c
        row[-1] = color_c
        intermediate.append(row)
    input_grid = []
    for r in range(input_height):
        if r % 2 == 0:
            input_grid.append(intermediate[r//2].copy())
        else:
            input_grid.append([random.randint(0, 9) for _ in range(width)])
    output_grid = [[color_c] * width for _ in range(intermediate_height)]
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if not input_grid:
        return []
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    intermediate = [row[:] for row in input_grid[::2]]
    width = len(intermediate[0])
    for row in intermediate:
        for c in range(1, 10):
            positions = [col for col in range(width) if row[col] == c]
            if not positions:
                continue
            left = min(positions)
            right = max(positions)
            for col in range(left, right + 1):
                if row[col] == 0:
                    row[col] = c
    return intermediate
