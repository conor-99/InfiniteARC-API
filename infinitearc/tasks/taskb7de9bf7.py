# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: b7de9bf7
Difficulty: insane

=== Tags ===
- Draw pattern from point
- Cascade fountain
- Take complement
- Cylindrical

=== Description ===
The input grid consists of a single non-background cell (color C) positioned at
a random location within a grid of dimensions between 1×1 and 30×30. All other
cells are background (color 0). The grid exhibits cylindrical topology, meaning
the left and right edges are connected (i.e., moving left from column 0 wraps to
the rightmost column, and moving right from the rightmost column wraps to column
0).  The output grid is derived through two sequential transformations:  1.
**Cascade Fountain**: Starting from the source cell, a pattern spreads downward
row by row. For each subsequent row below the source (row r + k, where k ≥ 1),
the pattern spans a width of (2k + 1) cells, centered around the source column.
Due to cylindrical topology, the pattern wraps around the grid edges.
Specifically, for row r + k, the pattern occupies columns (c - k) mod W to (c +
k) mod W (inclusive), where W is the grid width. This creates a vertically
expanding pyramid-shaped pattern that wraps around the cylindrical edges. The
pattern is drawn using the source color C.  2. **Take Complement**: The output
grid is the complement of the cascade pattern. This means all cells that were
part of the cascade pattern (non-background in the intermediate grid) are set to
background (0), and all cells not part of the pattern (background in the
intermediate grid) are set to the source color C.  The resulting output grid
displays a background (0) with a "hole" in the shape of the cascade pattern,
filled with the source color C. The pattern's shape is a vertically expanding
pyramid that wraps around the cylindrical edges, inverted through the complement
operation. This task requires recognizing the cylindrical edge wrapping effect,
understanding the symmetric expansion of the cascade, and applying the
complement inversion, all of which must be inferred from the input-output pairs
through abstract reasoning.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    W = random.randint(1, 30)
    H = random.randint(2, 30)
    r = random.randint(0, H - 2)
    c = random.randint(0, W - 1)
    C = random.randint(1, 9)
    
    input_grid = [[0] * W for _ in range(H)]
    input_grid[r][c] = C
    
    intermediate = [[0] * W for _ in range(H)]
    for k in range(1, H - r):
        row = r + k
        for offset in range(-k, k + 1):
            col = (c + offset) % W
            intermediate[row][col] = C
    
    output_grid = [[C if intermediate[i][j] == 0 else 0 for j in range(W)] for i in range(H)]
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    H = len(grid)
    W = len(grid[0])
    
    source_r, source_c = -1, -1
    C = 0
    for r in range(H):
        for c in range(W):
            if grid[r][c] != 0:
                source_r, source_c = r, c
                C = grid[r][c]
                break
        if source_r != -1:
            break
    
    intermediate = [[0] * W for _ in range(H)]
    for k in range(1, H - source_r):
        row = source_r + k
        for offset in range(-k, k + 1):
            col = (source_c + offset) % W
            intermediate[row][col] = C
    
    output = [[C if intermediate[i][j] == 0 else 0 for j in range(W)] for i in range(H)]
    
    return output
