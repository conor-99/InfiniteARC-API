# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-02
# ---------------------------------------------------------------

"""
Task ID: 897bce43
Difficulty: easy

=== Tags ===
- Snap to grid
- Detect background color
- Detect repetition
- Find the two identical shapes

=== Description ===
The task involves input grids where a background color (typically the most
frequent color, such as 0) is present, and two identical shapes (same color and
arrangement of pixels) are overlaid on this background. The output grid is
generated by replacing the pixels of these two identical shapes with a new,
distinct color (e.g., 9), while all other pixels remain unchanged. The
background color is identified as the dominant color in the grid, and the
identical shapes are determined by their matching color and spatial form. This
process requires detecting the background, identifying repeated structures, and
applying a consistent color replacement to the matching shapes.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
import random
from collections import Counter

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    bg = random.randint(0, 9)
    shape_color = random.choice([c for c in range(1, 9) if c != bg])
    
    shape_name = random.choice(["el", "you", "aitch"])
    shape_pixels = common.rand_sprite(shape_name, 3, 3)
    
    input_grid = common.grid(width, height, bg)
    
    if not shape_pixels:
        return generate()
    shape_rmin = min(r for r, c in shape_pixels)
    shape_rmax = max(r for r, c in shape_pixels)
    shape_cmin = min(c for r, c in shape_pixels)
    shape_cmax = max(c for r, c in shape_pixels)
    shape_height = shape_rmax - shape_rmin + 1
    shape_width = shape_cmax - shape_cmin + 1
    
    for r, c in shape_pixels:
        input_grid[r][c] = shape_color
    
    offset_r = height - shape_height
    offset_c = width - shape_width
    if offset_r < 0 or offset_c < 0:
        offset_r = 0
        offset_c = 0
    for r, c in shape_pixels:
        nr, nc = r + offset_r, c + offset_c
        if 0 <= nr < height and 0 <= nc < width:
            input_grid[nr][nc] = shape_color
    
    output_grid = [row[:] for row in input_grid]
    for r in range(height):
        for c in range(width):
            if output_grid[r][c] == shape_color:
                output_grid[r][c] = 9
    
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    all_vals = [val for row in input_grid for val in row]
    bg = max(set(all_vals), key=all_vals.count)
    colors = set(all_vals)
    colors.discard(bg)
    shape_color = colors.pop() if colors else 0
    
    output = []
    for row in input_grid:
        new_row = [9 if cell == shape_color else cell for cell in row]
        output.append(new_row)
    return output
