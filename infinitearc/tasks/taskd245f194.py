# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: d245f194
Difficulty: medium

=== Tags ===
- Portals

=== Description ===
The task involves input grids containing exactly two distinct "portal" cells of
the same non-zero color, positioned either horizontally or vertically aligned
with at least one cell between them. The output grid is derived by preserving
the portal cells' positions and color while filling all cells along the direct
horizontal or vertical path between them with a fixed color (e.g., color 5). The
transformation requires identifying the portal pair, determining their alignment
direction, and interpolating the connecting path with the designated color. This
rule is visually consistent, avoids numerical dependencies, and relies solely on
spatial relationships and color patterns to generate the output.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

def generate():
    import random
    w = random.randint(1, 30)
    h = random.randint(1, 30)
    is_horizontal = random.randint(0, 1)
    
    # Adjust grid size based on alignment
    if is_horizontal and w < 3:
        w = 3
    elif not is_horizontal and h < 3:
        h = 3
    
    grid = [[0] * w for _ in range(h)]
    C = random.randint(1, 9)
    
    if is_horizontal:
        r = random.randint(0, h - 1)
        c1 = random.randint(0, w - 3)
        c2 = c1 + random.randint(2, w - c1 - 1)
        grid[r][c1] = C
        grid[r][c2] = C
        between_cells = [(r, c) for c in range(c1 + 1, c2)]
    else:
        c = random.randint(0, w - 1)
        r1 = random.randint(0, h - 3)
        r2 = r1 + random.randint(2, h - r1 - 1)
        grid[r1][c] = C
        grid[r2][c] = C
        between_cells = [(r, c) for r in range(r1 + 1, r2)]
    
    # Fill between cells with non-C and non-5
    for (r, c) in between_cells:
        color = random.randint(0, 9)
        while color == C or color == 5:
            color = random.randint(0, 9)
        grid[r][c] = color
    
    output = [row[:] for row in grid]
    for (r, c) in between_cells:
        output[r][c] = 5
    
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    
    non_zero = []
    for r in range(len(input_grid)):
        for c in range(len(input_grid[0])):
            if input_grid[r][c] != 0:
                non_zero.append((r, c, input_grid[r][c]))
    
    color_groups = {}
    for (r, c, color) in non_zero:
        if color not in color_groups:
            color_groups[color] = []
        color_groups[color].append((r, c))
    
    for color, positions in color_groups.items():
        if len(positions) == 2:
            (r1, c1), (r2, c2) = positions
            if r1 == r2:
                start, end = min(c1, c2), max(c1, c2)
                between_cells = [(r1, c) for c in range(start + 1, end)]
            elif c1 == c2:
                start, end = min(r1, r2), max(r1, r2)
                between_cells = [(r, c1) for r in range(start + 1, end)]
            else:
                continue
            output = [row[:] for row in input_grid]
            for (r, c) in between_cells:
                output[r][c] = 5
            return output
    
    return input_grid
