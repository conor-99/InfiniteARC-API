# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-02
# ---------------------------------------------------------------

"""
Task ID: f8536016
Difficulty: hard

=== Tags ===
- Draw line from point
- Direction guessing
- Detect hor lines
- Tiling with constraints

=== Description ===
The input grid features horizontal line segments (contiguous sequences of the
same non-zero color in a single row) and a distinct point (marked by color 9).
The output requires drawing a vertical line from this point using a fixed color
(e.g., color 6), where the direction (upward or downward) is determined by the
majority position of the horizontal segments relative to the point's row.
Specifically, if more horizontal segments are located above the point's row, the
line extends upward; if more are below, it extends downward. The line continues
until the grid edge. The "tiling with constraints" aspect arises because the
horizontal segments collectively form a structured grid pattern (a "tiling"),
and the line must align with the tiling's vertical axis, avoiding interference
with the segment positions. This task demands precise detection of non-full-row
horizontal segments, aggregation of their positional data, and directional
reasoning based on spatial distributionâ€”making it challenging due to the need
for compositional spatial analysis rather than simple pattern matching.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
import common

def generate():
    width = random.randint(1, 30)
    height = random.randint(2, 30)  # Ensures height >= 2 to avoid empty row ranges
    
    if random.random() > 0.5:
        direction = 'up'
        r9 = random.randint(1, height-1)
        rows_above = list(range(r9))
        rows_below = []
    else:
        direction = 'down'
        r9 = random.randint(0, height-2)
        rows_above = []
        rows_below = list(range(r9+1, height))
    
    c9 = random.randint(0, width-1)
    
    grid = common.grid(width, height, 0)
    grid[r9][c9] = 9
    
    for r in rows_above:
        color = random.randint(1, 8)
        start = random.randint(0, width-1)
        length = random.randint(1, width - start)
        for c in range(start, start + length):
            grid[r][c] = color
    
    for r in rows_below:
        color = random.randint(1, 8)
        start = random.randint(0, width-1)
        length = random.randint(1, width - start)
        for c in range(start, start + length):
            grid[r][c] = color
    
    output = [row[:] for row in grid]
    if direction == 'up':
        for r in range(r9, -1, -1):
            output[r][c9] = 6
    else:
        for r in range(r9, height):
            output[r][c9] = 6
    
    return {'input': grid, 'output': output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    r9, c9 = None, None
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == 9:
                r9, c9 = r, c
    if r9 is None:
        raise ValueError("Point not found")
    
    segments_above = 0
    for r in range(r9):
        in_segment = False
        for c in range(width):
            if input_grid[r][c] != 0:
                if not in_segment:
                    segments_above += 1
                    in_segment = True
            else:
                in_segment = False
    
    segments_below = 0
    for r in range(r9+1, height):
        in_segment = False
        for c in range(width):
            if input_grid[r][c] != 0:
                if not in_segment:
                    segments_below += 1
                    in_segment = True
            else:
                in_segment = False
    
    direction = 'up' if segments_above > segments_below else 'down'
    
    output_grid = [row[:] for row in input_grid]
    if direction == 'up':
        for r in range(r9, -1, -1):
            output_grid[r][c9] = 6
    else:
        for r in range(r9, height):
            output_grid[r][c9] = 6
    
    return output_grid
