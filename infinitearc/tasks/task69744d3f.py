# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: 69744d3f
Difficulty: insane

=== Tags ===
- Interleaved streams
- Swap columns

=== Description ===
Input grids are 20×20 or larger, featuring a single background color (0)
overlaid with three or more distinct color streams (each stream being a
contiguous horizontal sequence of a single non-background color). These streams
occupy different rows (e.g., stream A in row 0, stream B in row 1, etc.), but
their columns are interleaved such that each column contains one cell from each
stream (in their respective rows). Separately, a 2×4 pattern strip—located in
the top-right corner of the grid—contains four distinct colors in a specific
sequence, which defines the target order for the streams. The pattern strip's
colors may include background (0) or non-background colors, but only non-
background colors dictate stream ordering.   The output grid is generated by
sorting the columns of the input such that all columns containing the first
color of the pattern strip (ignoring background) appear first, followed by
columns containing the second color, and so on. Within each color group, columns
retain their relative order from the input. This transformation groups each
stream into a contiguous horizontal line in its designated row, while preserving
the pattern strip and background. The pattern strip itself remains unchanged in
the output. The task requires identifying the pattern strip's color sequence,
mapping each column to its stream color via the reference row, and applying the
column sort order—no non-visual rules (e.g., sums, parities) are used.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width = 20
    height = 20
    input_grid = grid(width, height, 0)
    
    # Choose 4 distinct colors for streams
    colors = random.sample(range(1, 10), 4)
    
    # Set row 0 with interleaved streams
    for i in range(5):
        for j in range(4):
            input_grid[0][i + 5*j] = colors[j]
    
    # Set pattern strip (top-right 2x4)
    for c in range(4):
        input_grid[0][16 + c] = colors[c]
        input_grid[1][16 + c] = colors[c]
    
    # Output grid is sorted columns by pattern sequence
    sorted_cols = []
    for color in colors:
        for c in range(width):
            if input_grid[0][c] == color:
                sorted_cols.append(c)
    
    output_grid = grid(width, height, 0)
    for r in range(height):
        for c in range(width):
            output_grid[r][c] = input_grid[r][sorted_cols[c]]
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    
    # Extract pattern strip top row (top-right 2x4)
    pattern_colors = []
    for c in range(width - 4, width):
        if input_grid[0][c] != 0:
            pattern_colors.append(input_grid[0][c])
    
    # Create sort order from pattern_colors (non-background)
    sort_order = pattern_colors
    
    # Sort columns based on reference row (row 0)
    col_indices = list(range(width))
    col_indices.sort(key=lambda c: sort_order.index(input_grid[0][c]) if input_grid[0][c] in sort_order else float('inf'))
    
    # Build output grid
    output = [[0] * width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            output[r][c] = input_grid[r][col_indices[c]]
    
    return output
