# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-03
# ---------------------------------------------------------------

"""
Task ID: f7a50ad3
Difficulty: hard

=== Tags ===
- Pattern moving
- Connect components by property
- Detect wall
- Bounce

=== Description ===
The task involves transforming an input grid into an output grid where a moving
pattern interacts with walls and connects components based on color properties.
The input grid contains a distinct pattern (a connected shape composed of a
single color, e.g., color 2), walls (represented by a specific color, e.g.,
gray), and disconnected components of the same color as the pattern. The pattern
moves in a consistent direction (e.g., horizontally or vertically) until it
collides with a wall. Upon collision, it bounces, reversing its direction of
movement. The output grid reflects the pattern’s new position after the bounce,
and this new position connects two previously disconnected components of the
same color, merging them into a single connected region. Walls are detectable
via their specific color, and the pattern’s movement direction is inferred from
the grid structure (e.g., the pattern is positioned to move toward a wall). The
transformation requires identifying the pattern, determining its movement path,
detecting walls, applying the bounce, and verifying that the new position
bridges disconnected components of the pattern’s color. The complexity arises
from multiple walls, non-trivial pattern shapes, and the need to ensure
connectivity of components only after the bounce.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    grid_input = [[0] * width for _ in range(height)]
    r = random.randint(1, height - 2)
    c = random.randint(1, width - 2)
    grid_input[r][c] = 2
    grid_input[r][c+1] = 5
    grid_input[r-1][c-1] = 2
    grid_input[r+1][c-1] = 2
    grid_output = [row[:] for row in grid_input]
    grid_output[r][c] = 0
    grid_output[r][c-1] = 2
    return {
        "input": grid_input,
        "output": grid_output
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    width = len(input_grid[0])
    height = len(input_grid)
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == 2 and c + 1 < width and input_grid[r][c+1] == 5:
                output_grid = [row[:] for row in input_grid]
                output_grid[r][c] = 0
                output_grid[r][c-1] = 2
                return output_grid
    return input_grid
