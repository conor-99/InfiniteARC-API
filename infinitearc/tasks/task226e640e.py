# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 226e640e
Difficulty: medium–hard

=== Tags ===
- Cascade fountain

=== Description ===
# Cascade Fountain  Input grids feature a uniform background color (0) with one
or more "fountain source" cells (color 8) positioned near the top edge,
typically in the first two rows. Each source cell initiates a vertical cascade
flowing downward through the background cells. The output grid replaces all
background cells (0) directly below each source with a repeating sequence of
three distinct colors (1, 2, 3), starting with color 1 in the cell immediately
below the source. The sequence cycles continuously (1→2→3→1→2→3...) until
encountering a non-background cell (color > 0), at which point the cascade
stops. Background cells not part of any cascade remain unchanged. The sequence
order (1, 2, 3) is fixed and consistent across all cascades in a given task,
requiring the solver to discover this pattern through examination of input-
output examples. Cascades operate independently per column; overlapping cascades
from adjacent columns do not interact or merge. The task requires identifying
source locations, recognizing vertical flow direction, applying the color
sequence, and stopping at obstacles, with medium-hard difficulty due to the need
to track multiple independent vertical sequences while ignoring non-background
elements.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

def generate():
    import random
    w = random.randint(5, 20)
    h = random.randint(5, 20)
    input_grid = [[0] * w for _ in range(h)]
    
    num_sources = random.randint(1, 3)
    sources = []
    for _ in range(num_sources):
        r = random.choice([0, 1])
        c = random.randint(0, w-1)
        input_grid[r][c] = 8
        sources.append((r, c))
    
    for (r, c) in sources:
        s = random.randint(r+2, h-1) if r+2 <= h-1 else h-1
        obstacle_color = random.choice([1,2,3,4,5,6,7,9])
        input_grid[s][c] = obstacle_color
    
    output_grid = [row[:] for row in input_grid]
    
    for (r, c) in sources:
        s = r + 1
        while s < h and input_grid[s][c] == 0:
            s += 1
        for i in range(r+1, s):
            color = (i - r - 1) % 3 + 1
            output_grid[i][c] = color
    
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    h = len(grid)
    w = len(grid[0])
    
    for c in range(w):
        for r in range(h):
            if grid[r][c] == 8:
                obstacle_row = None
                for row in range(r + 1, h):
                    if grid[row][c] != 0:
                        obstacle_row = row
                        break
                end_row = obstacle_row if obstacle_row is not None else h
                for row in range(r + 1, end_row):
                    idx = row - r - 1
                    color = (idx % 3) + 1
                    grid[row][c] = color
    return grid
