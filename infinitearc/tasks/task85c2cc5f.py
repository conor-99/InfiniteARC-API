# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 85c2cc5f
Difficulty: very hard

=== Tags ===
- Inference from demonstration
- Column parity coloring

=== Description ===
# Task Description  **Task Name:** Parity Column Chroma  **Tags:** Inference
from demonstration, Column parity coloring  **Description:**   Input grids
consist of 2D arrangements where each column contains a sequence of colors
forming a distinct visual pattern. The output grid transforms each column based
on a hidden parity rule derived from the column's internal structure. The rule
is not directly visible from column indices or numerical properties but must be
inferred through comparison of input-output pairs.   In each column, the parity
(even or odd) is determined by the number of times the color changes between
adjacent cells in that column. Columns with an even number of color transitions
are uniformly recolored to a specific target color (e.g., blue), while columns
with an odd number of transitions are recolored to a different target color
(e.g., red). The target colors vary between examples but follow a consistent
mapping within each task instance.   Critical to the task is that the parity
determination requires visual inspection of the pattern rather than numerical
computationâ€”solving demands recognizing whether the sequence of color
transitions forms an even or odd count through pattern analysis. The
transformation applies to entire columns, replacing all cells in a column with
the target color determined by its parity. The background and non-column
features remain unchanged, and no two columns in a grid share identical patterns
to ensure the parity rule is uniquely determinable.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(1, 30)
    height = random.randint(1, 30)
    
    color_even = 1
    color_odd = 2
    
    input_grid = [[0] * width for _ in range(height)]
    output_grid = [[0] * width for _ in range(height)]
    
    for col in range(width):
        # Handle height=1 case
        if height == 1:
            parity = 'even'
        else:
            parity = 'even' if random.choice([True, False]) else 'odd'
        
        col_vals = [random.randint(0, 9) for _ in range(height)]
        transitions = 0
        if height > 1:
            for i in range(height - 1):
                if col_vals[i] != col_vals[i + 1]:
                    transitions += 1
        
        current_parity = 'even' if (height == 1 or transitions % 2 == 0) else 'odd'
        
        if current_parity != parity and height > 1:
            if col_vals[height - 2] == col_vals[height - 1]:
                choices = [c for c in range(10) if c != col_vals[height - 2]]
                col_vals[height - 1] = random.choice(choices)
            else:
                col_vals[height - 1] = col_vals[height - 2]
        
        for row in range(height):
            input_grid[row][col] = col_vals[row]
            
        if parity == 'even':
            for row in range(height):
                output_grid[row][col] = color_even
        else:
            for row in range(height):
                output_grid[row][col] = color_odd
    
    return {'input': input_grid, 'output': output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if not input_grid or not input_grid[0]:
        return input_grid
    width = len(input_grid[0])
    height = len(input_grid)
    color_even = 1
    color_odd = 2
    
    output_grid = [[0] * width for _ in range(height)]
    
    for col in range(width):
        transitions = 0
        for row in range(height - 1):
            if input_grid[row][col] != input_grid[row + 1][col]:
                transitions += 1
        
        if transitions % 2 == 0:
            for row in range(height):
                output_grid[row][col] = color_even
        else:
            for row in range(height):
                output_grid[row][col] = color_odd
    
    return output_grid
