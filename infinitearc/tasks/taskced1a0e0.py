# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-07
# ---------------------------------------------------------------

"""
Task ID: ced1a0e0
Difficulty: medium

=== Tags ===
- Remove intruders
- Pattern completion
- Image filling

=== Description ===
The task involves transforming an input grid into an output grid by identifying
and completing a primary pattern while removing extraneous elements. The input
grid contains a visual pattern formed by a single dominant color (the primary
color), which appears as a partially filled shape with stray pixels of other
colors (intruders) scattered within or outside the intended pattern area. The
output grid is generated by first removing all intruders (any pixels not
matching the primary color), then filling the minimal bounding rectangle that
contains all primary color pixels with the primary color, resulting in a solid,
complete rectangular shape with no extraneous elements. The bounding rectangle
is determined by the smallest rectangle that encloses all occurrences of the
primary color, and all pixels within this rectangle are set to the primary
color, while all pixels outside are set to the background (0). This process
ensures the pattern is visually complete and free of noise, demonstrating both
intruder removal and pattern completion through spatial reasoning.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    primary_color = common.random_color(exclude=[0])
    size = random.randint(5, min(20, width * height))
    pixels = common.continuous_creature(size, width, height)
    input_grid = common.grid(width, height, 0)
    for r, c in pixels:
        input_grid[r][c] = primary_color
    num_intruders = random.randint(3, 5)
    for _ in range(num_intruders):
        r = random.randint(0, height - 1)
        c = random.randint(0, width - 1)
        if (r, c) not in pixels:
            color = common.random_color(exclude=[0, primary_color])
            input_grid[r][c] = color
    primary_positions = []
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == primary_color:
                primary_positions.append((r, c))
    if not primary_positions:
        min_r = max_r = 0
        min_c = max_c = 0
    else:
        min_r = min(p[0] for p in primary_positions)
        max_r = max(p[0] for p in primary_positions)
        min_c = min(p[1] for p in primary_positions)
        max_c = max(p[1] for p in primary_positions)
    output_grid = common.grid(width, height, 0)
    for r in range(min_r, max_r + 1):
        for c in range(min_c, max_c + 1):
            output_grid[r][c] = primary_color
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

import common
from collections import defaultdict

def p(input_grid):
    color_count = defaultdict(int)
    for row in input_grid:
        for color in row:
            if color != 0:
                color_count[color] += 1
    if not color_count:
        return input_grid
    primary_color = max(color_count, key=color_count.get)
    height = len(input_grid)
    width = len(input_grid[0])
    positions = []
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == primary_color:
                positions.append((r, c))
    if not positions:
        return input_grid
    min_r = min(p[0] for p in positions)
    max_r = max(p[0] for p in positions)
    min_c = min(p[1] for p in positions)
    max_c = max(p[1] for p in positions)
    output_grid = [[0] * width for _ in range(height)]
    for r in range(min_r, max_r + 1):
        for c in range(min_c, max_c + 1):
            output_grid[r][c] = primary_color
    return output_grid
