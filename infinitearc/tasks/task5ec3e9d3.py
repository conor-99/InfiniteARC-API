# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 5ec3e9d3
Difficulty: hard

=== Tags ===
- Detect hor lines
- Measure distance from side

=== Description ===
The task requires identifying all horizontal line segments (contiguous sequences
of the same non-zero color spanning at least two cells in a row) within the
input grid. For each identified segment, the leftmost column index is
calculated, and all cells within the segment are replaced with this index modulo
10. Cells not part of any horizontal line segment retain their original color.
The output grid is generated by applying this transformation uniformly across
all rows, resulting in a grid where segment positions are encoded as numerical
distances from the left side, modulo 10.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    grid = [[0] * width for _ in range(height)]
    
    added_segment = False
    for r in range(height):
        if random.random() > 0.5 or not added_segment:
            color = random.randint(1, 9)
            length = random.randint(2, 5)
            start = random.randint(0, width - length)
            for c in range(start, start + length):
                grid[r][c] = color
            added_segment = True
    
    output = [[0] * width for _ in range(height)]
    for r in range(height):
        c = 0
        while c < width:
            if grid[r][c] == 0:
                output[r][c] = 0
                c += 1
                continue
            color = grid[r][c]
            start = c
            while c < width and grid[r][c] == color:
                c += 1
            seg_length = c - start
            if seg_length >= 2:
                val = start % 10
                for i in range(start, c):
                    output[r][i] = val
            else:
                for i in range(start, c):
                    output[r][i] = grid[r][i]
    
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    output = [[0] * width for _ in range(height)]
    
    for r in range(height):
        c = 0
        while c < width:
            if input_grid[r][c] == 0:
                output[r][c] = 0
                c += 1
                continue
            color = input_grid[r][c]
            start = c
            while c < width and input_grid[r][c] == color:
                c += 1
            seg_length = c - start
            if seg_length >= 2:
                val = start % 10
                for i in range(start, c):
                    output[r][i] = val
            else:
                for i in range(start, c):
                    output[r][i] = input_grid[r][i]
    return output
