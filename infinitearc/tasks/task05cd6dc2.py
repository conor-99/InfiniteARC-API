# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-10
# ---------------------------------------------------------------

"""
Task ID: 05cd6dc2
Difficulty: insane

=== Tags ===
- Inverse rule reconstruction

=== Description ===
Input grids consist of intricate, multi-layered patterns that have been
subjected to a sequence of reversible visual transformations, including
rotations, reflections, color inversions (where each color c is replaced by
9−c), and spatial shifts. Each input grid is derived from its corresponding
output grid through a unique but consistent composition of these operations,
with the transformations applied in a specific order that is not explicitly
indicated. The output grid represents the original pattern before any
transformations were applied.   To solve the task, the solver must deduce the
exact sequence of transformations applied to the output to produce the input by
analyzing the visual relationships between input and output grids. This requires
recognizing the nature of each transformation (e.g., identifying a 90-degree
rotation by observing how grid elements align diagonally) and determining the
correct order of operations. The complexity arises from overlapping
transformations (e.g., a rotation followed by a horizontal reflection changes
the direction of the reflection) and the need to reverse the sequence of
operations in the exact opposite order.   Input grids are large (20×20 or
larger) and contain multiple distinct shapes, colors, and background regions.
Transformations preserve the relative positions of elements within their regions
but alter their orientation, color, or location. The solver must isolate the
effects of each transformation without prior knowledge of the sequence,
leveraging visual cues such as symmetry, alignment, and color relationships. The
task demands recursive reasoning: identifying a single transformation may
require eliminating the effects of others, and misinterpreting the order leads
to incorrect reconstructions. Background elements serve as anchors to
disentangle transformations, while color inversion provides a visual clue for
detecting reversal.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate_base(size):
    grid = [[0] * size for _ in range(size)]
    for _ in range(size * size // 5):
        r = random.randint(0, size - 1)
        c = random.randint(0, size - 1)
        grid[r][c] = random.randint(1, 9)
    return grid

def rotate_90(grid):
    return [list(x)[::-1] for x in zip(*grid)]

def color_invert(grid):
    return [[9 - cell for cell in row] for row in grid]

def generate():
    size = random.randint(20, 30)
    base = generate_base(size)
    rotated = rotate_90(base)
    input_grid = color_invert(rotated)
    if input_grid == base:
        return generate()
    return {
        "input": input_grid,
        "output": base
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    inv = [[9 - cell for cell in row] for row in input_grid]
    return [list(x) for x in zip(*inv)][::-1]
