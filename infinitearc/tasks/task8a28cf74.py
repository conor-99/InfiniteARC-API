# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-02
# ---------------------------------------------------------------

"""
Task ID: 8a28cf74
Difficulty: hard

=== Tags ===
- Associate colors to images
- Axis inference

=== Description ===
The input grid contains multiple colored shapes, where each color corresponds to
a specific geometric pattern (e.g., color 1 = vertical line, color 2 =
horizontal line, color 3 = diagonal from top-left to bottom-right). The axis of
reflection is determined by the vertical line formed exclusively by color 4 (a
continuous vertical segment in a single column). The axis column is identified
by locating the column containing the most prominent vertical segment of color 4
(e.g., the column where color 4 appears across the greatest vertical span). All
non-color-4 pixels are mirrored horizontally across this axis column: a pixel at
column *c* in the input is relocated to column *2c_axis - c* in the output,
preserving its row and color. The color 4 line remains unchanged as it defines
the axis. The transformation requires recognizing color-4's role as the axis
marker, inferring its position from the grid's structure, and applying the
reflection consistently to all other colors. This task demands precise visual
pattern recognition, axis inference from contextual color patterns, and multi-
step spatial transformation without relying on numerical properties.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    axis_col = random.randint(1, (width - 1) // 2)
    input_grid = [[0]*width for _ in range(height)]
    
    for r in range(height):
        input_grid[r][axis_col] = 4
    
    colors = [1, 2, 3, 5, 6, 7, 8, 9]
    for c in range(axis_col):
        for r in range(height):
            if random.random() > 0.5:
                input_grid[r][c] = random.choice(colors)
    
    output_grid = [[0]*width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            mirror_c = 2 * axis_col - c
            output_grid[r][c] = input_grid[r][mirror_c]
    
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    
    max_run = -1
    axis_col = 0
    for j in range(width):
        current_run = 0
        col_max = 0
        for i in range(height):
            if input_grid[i][j] == 4:
                current_run += 1
            else:
                if current_run > col_max:
                    col_max = current_run
                current_run = 0
        if current_run > col_max:
            col_max = current_run
        if col_max > max_run:
            max_run = col_max
            axis_col = j
    
    output_grid = [[0]*width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            mirror_c = 2 * axis_col - c
            output_grid[r][c] = input_grid[r][mirror_c]
    
    return output_grid
