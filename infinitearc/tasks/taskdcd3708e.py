# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: dcd3708e
Difficulty: hard

=== Tags ===
- Global consistency enforcement
- Rule switch on context

=== Description ===
The input grid consists of a 2D arrangement of colored pixels (values 0-9),
where distinct shapes and patterns are formed by connected regions of the same
color. The critical context to identify is the presence of a T-shaped pattern: a
vertical line of at least three connected pixels of a specific color (e.g.,
color 5) with a horizontal line of three connected pixels centered atop it,
forming a clear "T" shape. This pattern must be visually recognizable as a
contiguous T-shape, not merely a random cluster of pixels. If such a T-shape
exists in the input, all pixels of color 2 are replaced with color 7, and all
pixels of color 8 are replaced with color 3. If no T-shape is present, all
pixels of color 2 are replaced with color 3, and all pixels of color 8 are
replaced with color 7. The output grid must apply these color transformations
globally and consistently across all pixels, regardless of position or
surrounding context, while maintaining all other colors unchanged. The task
requires discerning the T-shape's presence through visual pattern recognition
(not numerical analysis) and applying a rule that switches based on this
context, enforcing global consistency in the color replacement.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    has_t = random.choice([True, False])
    width = random.randint(1, 30)
    height = random.randint(1, 30)
    if has_t:
        width = max(3, width)
        height = max(3, height)
    
    input_grid = [[random.randint(0, 9) for _ in range(width)] for _ in range(height)]
    
    if has_t:
        r = random.randint(0, height - 3)
        c = random.randint(1, width - 2)
        input_grid[r][c-1] = 5
        input_grid[r][c] = 5
        input_grid[r][c+1] = 5
        input_grid[r+1][c] = 5
        input_grid[r+2][c] = 5
    else:
        for i in range(height):
            for j in range(width):
                if input_grid[i][j] == 5:
                    input_grid[i][j] = random.choice([x for x in range(10) if x != 5])
    
    has_2 = any(2 in row for row in input_grid)
    has_8 = any(8 in row for row in input_grid)
    if not has_2 and not has_8:
        if width >= 2:
            input_grid[0][0] = 2
            input_grid[0][1] = 8
        else:
            input_grid[0][0] = 2
    
    output_grid = [row[:] for row in input_grid]
    for i in range(height):
        for j in range(width):
            if output_grid[i][j] == 2:
                output_grid[i][j] = 7 if has_t else 3
            elif output_grid[i][j] == 8:
                output_grid[i][j] = 3 if has_t else 7
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    has_t = False
    for r in range(height):
        for c in range(width):
            if c > 0 and c < width - 1 and input_grid[r][c-1] == 5 and input_grid[r][c] == 5 and input_grid[r][c+1] == 5:
                if r < height - 2 and input_grid[r+1][c] == 5 and input_grid[r+2][c] == 5:
                    has_t = True
                    break
        if has_t:
            break
    
    output_grid = [row[:] for row in input_grid]
    for i in range(height):
        for j in range(width):
            if output_grid[i][j] == 2:
                output_grid[i][j] = 7 if has_t else 3
            elif output_grid[i][j] == 8:
                output_grid[i][j] = 3 if has_t else 7
    return output_grid
