# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 02a57add
Difficulty: mediumâ€“hard

=== Tags ===
- Directed cave maze
- Gas expansion
- Pattern translation
- Associate colors to shapes
- Rotate to canonical

=== Description ===
The input grid represents a cave maze composed of background cells (color 0),
wall cells (color 1), and a directed path (color 2) formed by a continuous
sequence of connected cells. The path has a clear direction (e.g., left-to-
right, top-to-bottom) determined by the sequence of path cells. Scattered along
the path are gas sources (colors 3, 4, 5), each corresponding to a distinct
shape: color 3 = horizontal line, color 4 = square, color 5 = triangle. Each
shape may appear rotated in the input grid (e.g., a line may be vertical instead
of horizontal).  The output grid is generated by propagating the gas source
along the path's direction. Starting from the gas source cell, every subsequent
cell along the path (in the direction of the path) is filled with the
corresponding shape color. Crucially, each shape must be rotated to its
canonical orientation: lines (color 3) are rotated to horizontal, squares (color
4) remain axis-aligned (no rotation needed), and triangles (color 5) are rotated
to point upward. The maze walls and background cells remain unchanged, and the
gas propagation stops at the end of the path or upon encountering a wall. The
transformation requires recognizing the path direction, associating colors with
shapes, and applying the correct rotation to each shape.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width = random.randint(5, 20)
    height = random.randint(5, 20)
    grid_val = grid(width, height, 0)
    is_horizontal = random.choice([True, False])
    if is_horizontal:
        row = random.randint(1, height-2)
        start_col = random.randint(1, width-3)
        end_col = start_col + random.randint(2, 5)
        if end_col >= width-1:
            end_col = width-2
        for c in range(start_col, end_col+1):
            grid_val[row][c] = 2
        for c in range(start_col, end_col+1):
            if row > 0: grid_val[row-1][c] = 1
            if row < height-1: grid_val[row+1][c] = 1
        if start_col > 0: grid_val[row][start_col-1] = 1
        if end_col < width-1: grid_val[row][end_col+1] = 1
        gas_pos = random.randint(start_col, end_col-1)
        gas_color = random.choice([3, 4, 5])
        grid_val[row][gas_pos] = gas_color
        output_val = [row[:] for row in grid_val]
        for c in range(gas_pos+1, end_col+1):
            output_val[row][c] = gas_color
    else:
        col = random.randint(1, width-2)
        start_row = random.randint(1, height-3)
        end_row = start_row + random.randint(2, 5)
        if end_row >= height-1:
            end_row = height-2
        for r in range(start_row, end_row+1):
            grid_val[r][col] = 2
        for r in range(start_row, end_row+1):
            if col > 0: grid_val[r][col-1] = 1
            if col < width-1: grid_val[r][col+1] = 1
        if start_row > 0: grid_val[start_row-1][col] = 1
        if end_row < height-1: grid_val[end_row+1][col] = 1
        gas_pos = random.randint(start_row, end_row-1)
        gas_color = random.choice([3, 4, 5])
        grid_val[gas_pos][col] = gas_color
        output_val = [row[:] for row in grid_val]
        for r in range(gas_pos+1, end_row+1):
            output_val[r][col] = gas_color
    return {'input': grid_val, 'output': output_val}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    gas_pos = None
    gas_color = None
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] in [3, 4, 5]:
                gas_pos = (r, c)
                gas_color = input_grid[r][c]
    if gas_pos is None:
        return input_grid
    r, c = gas_pos
    if c + 1 < width and input_grid[r][c+1] == 2:
        for c2 in range(c+1, width):
            if input_grid[r][c2] != 2:
                break
            input_grid[r][c2] = gas_color
    elif c - 1 >= 0 and input_grid[r][c-1] == 2:
        for c2 in range(c-1, -1, -1):
            if input_grid[r][c2] != 2:
                break
            input_grid[r][c2] = gas_color
    elif r + 1 < height and input_grid[r+1][c] == 2:
        for r2 in range(r+1, height):
            if input_grid[r2][c] != 2:
                break
            input_grid[r2][c] = gas_color
    elif r - 1 >= 0 and input_grid[r-1][c] == 2:
        for r2 in range(r-1, -1, -1):
            if input_grid[r2][c] != 2:
                break
            input_grid[r2][c] = gas_color
    return input_grid
