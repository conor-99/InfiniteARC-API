# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: 0970a467
Difficulty: insane

=== Tags ===
- Obstacles
- Spacing
- Draw parallel line
- Run turing machine on tape

=== Description ===
The input grid features a horizontal tape row composed of colored cells
representing symbols, with certain cells marked as obstacles (a specific color
that prevents movement). The machine head (a distinct color indicating the
current state) starts at a designated position on the tape. The Turing machine
processes the tape by moving right each step, altering the current cell's color
based on the head's color and the cell's current color, reversing direction upon
encountering an obstacle. After processing completes (typically when the machine
encounters an obstacle or reaches a cycle), the output grid displays the
modified tape row and overlays vertical parallel lines spaced at consistent
intervals (e.g., every 3 columns) across the entire grid, creating a grid
pattern that aligns with the positions visited during processing. Obstacles
cause directional changes in the machine's path, resulting in non-linear tape
modifications that influence the placement and spacing of the lines in the
output.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 30)
    height = random.randint(1, 30)
    input_grid = [[0] * width for _ in range(height)]
    
    input_grid[0][0] = 2
    obstacle_positions = random.sample(range(2, width), random.randint(1, width-2))
    for pos in obstacle_positions:
        input_grid[0][pos] = 5
    
    for col in range(1, width):
        if input_grid[0][col] == 0:
            input_grid[0][col] = random.choice([1, 3, 4])
    
    tape_row = input_grid[0]
    p = 0
    direction = 1
    while 0 <= p < width:
        if tape_row[p] == 5:
            direction *= -1
        else:
            tape_row[p] = (tape_row[p] + 1) % 4 + 1
        p += direction
    
    output_grid = [row[:] for row in input_grid]
    for i in range(height):
        for j in range(width):
            if j % 3 == 0:
                output_grid[i][j] = 7
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    
    tape_row_idx = None
    for i in range(len(input_grid)):
        if 2 in input_grid[i]:
            tape_row_idx = i
            break
    if tape_row_idx is None:
        tape_row_idx = 0
    
    tape_row = input_grid[tape_row_idx][:]
    try:
        p = tape_row.index(2)
    except ValueError:
        p = 0
    
    direction = 1
    width = len(tape_row)
    while 0 <= p < width:
        if tape_row[p] == 5:
            direction *= -1
        else:
            tape_row[p] = (tape_row[p] + 1) % 4 + 1
        p += direction
    
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = []
    for i in range(height):
        output_grid.append([0] * width)
    
    for i in range(height):
        for j in range(width):
            if j % 3 == 0:
                output_grid[i][j] = 7
            else:
                if i == tape_row_idx:
                    output_grid[i][j] = tape_row[j]
                else:
                    output_grid[i][j] = 0
    return output_grid
