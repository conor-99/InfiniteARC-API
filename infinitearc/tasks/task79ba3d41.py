# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: 79ba3d41
Difficulty: insane

=== Tags ===
- Mutual reflection
- Pattern intersection
- Algebra
- Size guessing

=== Description ===
Input grids feature multiple colored geometric shapes (e.g., rectangles,
L-shapes, crosses) arranged such that each shape has a mirror image counterpart
reflected across a diagonal axis (either main or anti-diagonal), but only one
half of each reflection pair is visible. The intersection of a shape with its
reflection creates a new pattern whose color follows a predefined color algebra
(e.g., red + blue = purple), and whose dimensions are determined by the
overlapping region of the original shape and its reflection. The solver must:
(1) identify the correct diagonal axis for each reflection pair by analyzing
symmetry across the grid, (2) add the missing reflection for each shape, (3)
compute the intersection patterns using the color algebra, and (4) infer the
size of each intersection through geometric reasoning. The output grid must
include all original shapes, their reflections, and the intersection patterns at
their correct positions, requiring simultaneous application of symmetry
analysis, color mapping, and spatial size estimation across multiple overlapping
pattern pairs.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width = random.randint(10, 30)
    height = random.randint(10, 30)
    input_grid = grid(width, height, 0)
    output_grid = grid(width, height, 0)

    num_shapes = random.randint(3, 5)
    for _ in range(num_shapes):
        max_r1 = min(height-2, width-2)
        r1 = random.randint(0, max_r1)
        c1 = random.randint(r1+1, width-1)
        r2 = random.randint(r1, height-1)
        c2 = random.randint(c1, width-1)
        if r2 >= r1 and c2 >= c1:
            color = random.randint(1, 9)
            for r in range(r1, r2+1):
                for c in range(c1, c2+1):
                    if r < c:
                        input_grid[r][c] = color

    for r in range(height):
        for c in range(width):
            output_grid[r][c] = input_grid[r][c]

    for r in range(height):
        for c in range(width):
            if r < c and input_grid[r][c] != 0 and c < height:
                output_grid[c][r] = input_grid[r][c]

    for r in range(min(width, height)):
        if r+1 < width and input_grid[r][r+1] != 0:
            color = input_grid[r][r+1]
            output_grid[r][r] = (color * 2) % 10

    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    width = len(grid[0])
    height = len(grid)
    output = [row[:] for row in grid]

    for r in range(height):
        for c in range(width):
            if r < c and grid[r][c] != 0 and c < height:
                output[c][r] = grid[r][c]

    for r in range(min(width, height)):
        if r + 1 < width and grid[r][r + 1] != 0:
            color = grid[r][r + 1]
            output[r][r] = (color * 2) % 10
    return output
