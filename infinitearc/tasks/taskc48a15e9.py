# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: c48a15e9
Difficulty: very hard

=== Tags ===
- Gas expansion

=== Description ===
The input grids feature a background color (0) surrounded by a container defined
by walls of colors 2–9. Within this container, a contiguous gas region (color 1)
occupies a non-convex shape, containing at least one concavity (an indentation
in its boundary). The gas region is fully enclosed by walls, with no gaps to the
container's exterior.   The transformation rule requires expanding the gas
region to fill all concavities while maintaining the container's boundaries.
Specifically, the output grid displays the gas region after it has been expanded
outward to form a convex shape, where every boundary point now contributes to a
convex angle (≤ 180°). This expansion occurs by adding gas cells to all adjacent
background cells that would eliminate concavities, but only if such additions do
not extend beyond the container walls. Crucially, the expansion must preserve
the original gas region's "core" structure while smoothing the boundary into
convexity—no new gas cells are added in directions where the container walls
prevent expansion. Walls and background remain unchanged, and the gas color (1)
is preserved throughout the transformation. The task demands recognizing
geometric concavities, understanding their relationship to container boundaries,
and applying a non-trivial convex hull-like operation to the gas region.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(7, 30)
    height = random.randint(7, 30)
    grid = [[0] * width for _ in range(height)]
    
    # Set border to walls (color 2)
    for i in range(width):
        grid[0][i] = 2
        grid[height-1][i] = 2
    for j in range(height):
        grid[j][0] = 2
        grid[j][width-1] = 2
    
    # Determine gas region size (at least 3x3)
    gas_size = random.randint(3, min(width-4, height-4))
    gas_start_row = random.randint(2, height - gas_size - 2)
    gas_start_col = random.randint(2, width - gas_size - 2)
    gas_end_row = gas_start_row + gas_size
    gas_end_col = gas_start_col + gas_size
    
    # Fill gas region
    for r in range(gas_start_row, gas_end_row):
        for c in range(gas_start_col, gas_end_col):
            grid[r][c] = 1
    
    # Remove a cell from the boundary (not corners) to create concavity
    if random.choice([True, False]):
        remove_row = gas_start_row
        remove_col = random.randint(gas_start_col + 1, gas_end_col - 2)
    else:
        remove_row = gas_end_row - 1
        remove_col = random.randint(gas_start_col + 1, gas_end_col - 2)
    
    grid[remove_row][remove_col] = 0
    
    # Output is input with that cell set to 1
    output_grid = [row[:] for row in grid]
    output_grid[remove_row][remove_col] = 1
    
    return {"input": grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    grid = [list(row) for row in input_grid]
    width = len(grid[0])
    height = len(grid)
    
    gas_cells = []
    for r in range(height):
        for c in range(width):
            if grid[r][c] == 1:
                gas_cells.append((r, c))
    
    if not gas_cells:
        return grid
    
    min_row = min(r for r, c in gas_cells)
    max_row = max(r for r, c in gas_cells)
    min_col = min(c for r, c in gas_cells)
    max_col = max(c for r, c in gas_cells)
    
    for r in range(min_row, max_row + 1):
        for c in range(min_col, max_col + 1):
            if grid[r][c] == 0:
                grid[r][c] = 1
    
    return grid
