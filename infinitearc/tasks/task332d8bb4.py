# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 332d8bb4
Difficulty: medium

=== Tags ===
- Associate colors to patterns
- Remove intruders

=== Description ===
The task involves transforming an input grid into an output grid by identifying
and retaining the primary pattern associated with a specific color while
removing all other elements. The input grid contains a distinct visual pattern
(e.g., a vertical line, square, or diagonal) formed by a single color, alongside
secondary patterns or "intruders" formed by other colors. The output grid must
preserve only the cells of the color corresponding to the primary pattern,
setting all other cells to the background color (0).   The primary pattern is
visually distinguishable (e.g., a vertical line is unambiguous compared to a
square), and the color associated with this pattern is consistent across
examples. For instance, a vertical line pattern might always be represented by
color 2, while squares or diagonals in other colors (e.g., 3, 4) are considered
intruders. The solver must associate the pattern's shape with its color and
remove all non-matching elements. This requires recognizing the pattern's
structure and linking it to the correct color, rather than relying on numerical
properties or pixel-level matching. The task is medium difficulty as it demands
both visual pattern recognition and color association, with inputs containing
multiple patterns to distinguish the primary one from intruders.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(5, 15)
    height = random.randint(5, 15)
    grid = [[0] * width for _ in range(height)]
    
    col = random.randint(0, width - 1)
    line_length = random.randint(3, 5)
    primary_color = random.randint(1, 9)
    for r in range(line_length):
        grid[r][col] = primary_color
    
    intruder_colors = []
    while len(intruder_colors) < 2:
        color = random.randint(1, 9)
        if color != primary_color and color not in intruder_colors:
            intruder_colors.append(color)
    
    # Add square without overlapping primary vertical line
    if intruder_colors:
        color = intruder_colors[0]
        while True:
            r_start = random.randint(0, height - 2)
            c_start = random.randint(0, width - 2)
            overlap = False
            for dr in range(2):
                for dc in range(2):
                    r = r_start + dr
                    c = c_start + dc
                    if c == col and r < line_length:
                        overlap = True
                        break
                if overlap:
                    break
            if not overlap:
                for dr in range(2):
                    for dc in range(2):
                        grid[r_start + dr][c_start + dc] = color
                break
    
    # Add diagonal without overlapping primary vertical line
    if len(intruder_colors) > 1:
        color = intruder_colors[1]
        while True:
            r_start = random.randint(0, height - 3)
            c_start = random.randint(0, width - 3)
            overlap = False
            for i in range(3):
                r = r_start + i
                c = c_start + i
                if c == col and r < line_length:
                    overlap = True
                    break
            if not overlap:
                for i in range(3):
                    if r_start + i < height and c_start + i < width:
                        grid[r_start + i][c_start + i] = color
                break
    
    output = [[primary_color if grid[r][c] == primary_color else 0 for c in range(width)] for r in range(height)]
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    
    colors = set()
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] != 0:
                colors.add(input_grid[r][c])
    
    primary_color = None
    for color in colors:
        positions = [(r, c) for r in range(height) for c in range(width) if input_grid[r][c] == color]
        if not positions:
            continue
        col = positions[0][1]
        rows = [p[0] for p in positions]
        if all(p[1] == col for p in positions) and max(rows) - min(rows) + 1 == len(rows):
            primary_color = color
            break
    
    if primary_color is None:
        primary_color = next(iter(colors)) if colors else 0
    
    return [[primary_color if input_grid[r][c] == primary_color else 0 for c in range(width)] for r in range(height)]
