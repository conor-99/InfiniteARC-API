# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-03
# ---------------------------------------------------------------

"""
Task ID: 6eea6de3
Difficulty: hard

=== Tags ===
- Proximity guessing
- Pattern completion

=== Description ===
The task involves input grids containing partial rectangles where three corners
of an axis-aligned rectangle are present (all of the same non-zero color), and
the output grid completes each such rectangle by adding the fourth corner with
the same color. The transformation requires identifying all sets of three points
that form three corners of a rectangle (i.e., two points share a row, two share
a column, and the third point completes the rectangle), and then setting the
missing corner to the same color. This involves relational reasoning about the
relative positions of cells (proximity) to determine the missing element
(pattern completion). The rule is deterministic: for every valid trio of
corners, the missing corner is added, and no other changes occur. The output
grid differs from the input grid only by the addition of these missing corners,
and the task requires recognizing the geometric pattern through abstract spatial
reasoning rather than pixel-level analysis.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

def generate():
    import random
    import common
    width = random.randint(3, 30)
    height = random.randint(3, 30)
    color = random.randint(1, 9)
    r1 = random.randint(0, height - 2)
    r2 = random.randint(r1 + 1, height - 1)
    c1 = random.randint(0, width - 2)
    c2 = random.randint(c1 + 1, width - 1)
    missing = random.randint(0, 3)
    input_grid = common.grid(width, height, 0)
    if missing == 0:
        input_grid[r1][c1] = color
        input_grid[r1][c2] = color
        input_grid[r2][c1] = color
    elif missing == 1:
        input_grid[r1][c2] = color
        input_grid[r2][c1] = color
        input_grid[r2][c2] = color
    elif missing == 2:
        input_grid[r1][c1] = color
        input_grid[r2][c1] = color
        input_grid[r2][c2] = color
    elif missing == 3:
        input_grid[r1][c1] = color
        input_grid[r1][c2] = color
        input_grid[r2][c2] = color
    output_grid = [row[:] for row in input_grid]
    if missing == 0:
        output_grid[r2][c2] = color
    elif missing == 1:
        output_grid[r1][c1] = color
    elif missing == 2:
        output_grid[r1][c2] = color
    elif missing == 3:
        output_grid[r2][c1] = color
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    output_grid = [row[:] for row in input_grid]
    h = len(input_grid)
    w = len(input_grid[0])
    for r1 in range(h):
        for r2 in range(r1 + 1, h):
            for c1 in range(w):
                for c2 in range(c1 + 1, w):
                    corners = [
                        input_grid[r1][c1],
                        input_grid[r1][c2],
                        input_grid[r2][c1],
                        input_grid[r2][c2]
                    ]
                    non_zero = [c for c in corners if c != 0]
                    if len(non_zero) == 3 and all(x == non_zero[0] for x in non_zero):
                        if corners[0] == 0:
                            output_grid[r1][c1] = non_zero[0]
                        elif corners[1] == 0:
                            output_grid[r1][c2] = non_zero[0]
                        elif corners[2] == 0:
                            output_grid[r2][c1] = non_zero[0]
                        elif corners[3] == 0:
                            output_grid[r2][c2] = non_zero[0]
    return output_grid
