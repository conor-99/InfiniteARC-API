# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: 31962da1
Difficulty: hard

=== Tags ===
- Recolor
- Pattern reflection

=== Description ===
The task involves transforming an input grid into an output grid through two
sequential visual operations: pattern reflection and recoloring. The input grids
contain distinct, connected regions of solid colors arranged to form a dominant
line pattern (either vertical or horizontal), which determines the reflection
axis.   First, the dominant line pattern is identified visually: a continuous
vertical line spanning at least 70% of the grid's height indicates a vertical
line, while a horizontal line spanning at least 70% of the grid's width
indicates a horizontal line. The grid is then reflected across the corresponding
axis (vertical reflection flips left-right; horizontal reflection flips up-
down).   Second, all colors undergo a fixed recoloring transformation based on a
consistent visual sequence: color 1 (red) becomes color 2 (blue), color 2
becomes color 3 (green), ..., color 9 becomes color 1. This mapping is
independent of the input's numerical values and relies solely on the visual
order of colors.  The challenge for the solver lies in correctly identifying the
line pattern's orientation to determine the reflection axis (a non-trivial
visual analysis), followed by applying the color sequence transformation. The
task requires sequential reasoning across multiple visual features, making it
difficult to generalize without recognizing both the reflection rule and the
recoloring pattern.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
import math

def generate():
    width = common.randint(1, 30)
    height = common.randint(1, 30)
    grid = [[0] * width for _ in range(height)]
    
    is_vertical = common.choice([True, False])
    
    if is_vertical:
        col = common.randint(0, width - 1)
        min_length = max(1, math.ceil(0.7 * height))
        length = common.randint(min_length, height)
        start_row = common.randint(0, height - length)
        for r in range(start_row, start_row + length):
            grid[r][col] = 1
        for r in range(height):
            for c in range(width):
                if grid[r][c] != 1:
                    grid[r][c] = common.random_color(exclude=[1])
    else:
        row = common.randint(0, height - 1)
        min_length = max(1, math.ceil(0.7 * width))
        length = common.randint(min_length, width)
        start_col = common.randint(0, width - length)
        for c in range(start_col, start_col + length):
            grid[row][c] = 1
        for r in range(height):
            for c in range(width):
                if grid[r][c] != 1:
                    grid[r][c] = common.random_color(exclude=[1])
    
    if is_vertical:
        reflected = [row[::-1] for row in grid]
    else:
        reflected = grid[::-1]
    
    output = [[(c % 9) + 1 for c in row] for row in reflected]
    
    return {
        "input": grid,
        "output": output
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

import common

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    
    max_vertical = 0
    for c in range(width):
        current = 0
        max_in_col = 0
        for r in range(height):
            if input_grid[r][c] == 1:
                current += 1
                max_in_col = max(max_in_col, current)
            else:
                current = 0
        if max_in_col > max_vertical:
            max_vertical = max_in_col
    
    if max_vertical * 10 >= 7 * height:
        reflected = [row[::-1] for row in input_grid]
    else:
        max_horizontal = 0
        for r in range(height):
            current = 0
            max_in_row = 0
            for c in range(width):
                if input_grid[r][c] == 1:
                    current += 1
                    max_in_row = max(max_in_row, current)
                else:
                    current = 0
            if max_in_row > max_horizontal:
                max_horizontal = max_in_row
        
        if max_horizontal * 10 >= 7 * width:
            reflected = input_grid[::-1]
        else:
            reflected = [row[::-1] for row in input_grid]
    
    output = [[(c % 9) + 1 for c in row] for row in reflected]
    return output
