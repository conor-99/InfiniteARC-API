# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: 92e7966e
Difficulty: insane

=== Tags ===
- Symbolic spatial binding
- Symmetry axis completion

=== Description ===
# Symmetric Binding Matrix  Input grids are large (20×20) with a single
background color (0). The grid contains colored symbols (1-9) arranged in a non-
symmetrical pattern, with specific "binding anchors" (color 9) placed at
strategic positions. Binding anchors do not form part of any binding pair but
serve as reference points for identifying binding pairs.  A binding pair
consists of two symbols of identical color (not 9) that share a specific spatial
relationship with respect to a binding anchor. The binding anchor acts as a
pivot point, with the two symbols forming a symmetric relationship around a line
that passes through the anchor. The axis of symmetry is determined by the vector
relationship between the anchor and the binding pair: the axis is perpendicular
to the line connecting the anchor to the midpoint of the binding pair and passes
through the anchor.  The output grid must complete the symmetry for all binding
pairs by adding mirror images of each symbol across the determined axis. The
axis is uniquely determined by all binding pairs in the input (all binding pairs
must share the same axis). The binding pairs are not immediately obvious—they
require identifying which symbols form pairs based on their relationship to
binding anchors.  For each binding pair (A, B) with anchor C: 1. Calculate the
midpoint M between A and B 2. The axis is the line perpendicular to vector CM
passing through C 3. For every symbol in the input (except binding anchors and
binding pairs), add its mirror image across the axis 4. If a mirror image
already exists in the input, it is preserved 5. Binding anchors remain in their
original positions  The binding pairs must form a consistent pattern where all
pairs align with the same axis. The grid contains multiple binding pairs (3-5),
and the axis is not aligned with grid lines (it may be diagonal or at an angle).
The output grid contains the complete symmetric pattern with all mirror images
added, while preserving the original grid elements that were not part of binding
pairs. The solution requires identifying the binding anchors, determining the
binding pairs, calculating the symmetry axis, and applying the mirror
transformation to all relevant symbols.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    size = random.randint(15, 30)
    grid = [[0] * size for _ in range(size)]
    
    # Place anchors on y=x
    for i in range(3, size-3, 3):
        if i < size:
            grid[i][i] = 9
    
    # Create binding pairs
    colors = list(range(1, 9))
    random.shuffle(colors)
    num_pairs = random.randint(3, 5)
    for i in range(num_pairs):
        color = colors[i]
        while True:
            r, c = random.randint(0, size-1), random.randint(0, size-1)
            if r != c:
                break
        grid[r][c] = color
        grid[c][r] = color
    
    # Add single symbols
    for _ in range(random.randint(5, 10)):
        while True:
            r, c = random.randint(0, size-1), random.randint(0, size-1)
            if r != c and grid[r][c] == 0:
                break
        grid[r][c] = random.randint(1, 8)
    
    output = [row[:] for row in grid]
    for r in range(size):
        for c in range(size):
            if grid[r][c] != 0 and grid[r][c] != 9:
                if r != c and grid[r][c] == grid[c][r]:
                    continue
                if output[c][r] == 0:
                    output[c][r] = grid[r][c]
    
    return {
        "input": grid,
        "output": output
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    size = len(input_grid)
    grid = [list(row) for row in input_grid]
    
    # Find anchors
    anchors = []
    for r in range(size):
        for c in range(size):
            if grid[r][c] == 9:
                anchors.append((r, c))
    
    # Assume axis is y=x
    output = [row[:] for row in grid]
    for r in range(size):
        for c in range(size):
            if grid[r][c] == 0 or grid[r][c] == 9:
                continue
            if r != c and grid[r][c] == grid[c][r]:
                continue
            if output[c][r] == 0:
                output[c][r] = grid[r][c]
    
    return output
