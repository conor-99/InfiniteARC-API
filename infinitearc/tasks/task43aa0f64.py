# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 43aa0f64
Difficulty: insane

=== Tags ===
- Jigsaw
- Color permutation
- Associate colors to ranks
- Extrapolate image from grid

=== Description ===
The input grid represents a jigsaw puzzle composed of disconnected regions
(pieces), each region uniformly colored with a value from 1 to 9. Each color's
rank corresponds to its numerical value (e.g., color 5 has rank 5). The
transformation involves two steps: first, applying a fixed color permutation
(e.g., color c maps to (c + 3) mod 9, with 0 mapping to 9), and second,
rearranging the grid to form a contiguous image where pieces are ordered by
their permuted rank (from lowest to highest). The output grid is generated by
applying the color permutation to all cells, then sorting the grid's elements in
row-major order based on the permuted color values, resulting in a contiguous
arrangement of pieces ordered by rank.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid
def generate():
    width = random.randint(5, 15)
    height = random.randint(5, 15)
    input_grid = grid(width, height)
    
    color = 1
    start_row = 0
    regions = 0
    while start_row < height:
        end_row = min(start_row + random.randint(2, 5), height)
        for r in range(start_row, end_row):
            for c in range(width):
                input_grid[r][c] = color
        color += 1
        regions += 1
        start_row = end_row
        if regions >= 2:
            break
    
    if regions == 1:
        for r in range(height):
            for c in range(width):
                input_grid[r][c] = 1 if c < width // 2 else 2
    
    output_grid = grid(width, height)
    for r in range(height):
        for c in range(width):
            c_val = input_grid[r][c]
            new_color = (c_val + 3) % 9
            if new_color == 0:
                new_color = 9
            output_grid[r][c] = new_color
    
    cells = []
    for r in range(height):
        for c in range(width):
            cells.append((output_grid[r][c], r, c))
    cells.sort(key=lambda x: (x[0], x[1], x[2]))
    
    final_output = grid(width, height)
    for idx in range(height * width):
        r, c = divmod(idx, width)
        final_output[r][c] = cells[idx][0]
    
    return {"input": input_grid, "output": final_output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    width = len(input_grid[0])
    height = len(input_grid)
    permuted = [[0] * width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            c_val = input_grid[r][c]
            new_color = (c_val + 3) % 9
            if new_color == 0:
                new_color = 9
            permuted[r][c] = new_color
    
    cells = []
    for r in range(height):
        for c in range(width):
            cells.append((permuted[r][c], r, c))
    cells.sort(key=lambda x: (x[0], x[1], x[2]))
    
    output = [[0] * width for _ in range(height)]
    for idx in range(height * width):
        r, c = divmod(idx, width)
        output[r][c] = cells[idx][0]
    
    return output
