# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 811ed89d
Difficulty: hard

=== Tags ===
- Momentum transfer
- Exclusive or coloring
- Associate images to images

=== Description ===
Input grids are large (20Ã—20) with a single background color. Scattered across
the grid are interconnected colored track segments (a consistent non-background
color) forming a network of paths that connect to the grid's edges. On these
tracks, there are multiple single-cell particles (each a distinct color)
positioned at various points. Each particle moves along its track in the
direction dictated by the track's orientation (e.g., horizontal tracks move
particles left-to-right, vertical tracks move particles top-to-bottom). When two
particles moving toward each other collide on a track segment, they are replaced
by a new particle whose color is determined by a fixed exclusive or color
mapping: red and blue combine to form green, red and green combine to form blue,
blue and green combine to form red, and particles of identical color pass
through each other unaffected. The output grid displays the final state after
all particles have exited the grid, with collision points transformed according
to the color mapping. Track segments and background remain unchanged throughout
the transformation. This task requires recognizing track networks, tracking
particle motion, and applying the color transformation rule at each collision,
making it a complex multi-step visual reasoning challenge.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    size = 20
    background = random.choice([0, 4, 6, 7, 8, 9])
    track_color = 5
    grid = [[background] * size for _ in range(size)]
    
    # Draw horizontal track
    r = random.randint(5, 14)
    for c in range(size):
        grid[r][c] = track_color
    
    # Draw vertical track
    c = random.randint(5, 14)
    for r in range(size):
        grid[r][c] = track_color
    
    # Place particles
    start1 = random.randint(1, c-2)
    start2 = random.randint(c+1, size-2)
    grid[r][start1] = random.choice([1, 2])
    grid[r][start2] = 3 if grid[r][start1] == 1 else 2
    
    input_grid = [row[:] for row in grid]
    output_grid = [[background if cell not in [track_color] else cell for cell in row] for row in input_grid]
    
    return {
        'input': input_grid,
        'output': output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    colors_in_grid = set()
    for row in input_grid:
        for cell in row:
            colors_in_grid.add(cell)
    
    # Background is the color not in [1,2,3,5]
    bg = (colors_in_grid - {1, 2, 3, 5}).pop()
    
    input_list = [list(row) for row in input_grid]
    for r in range(len(input_list)):
        for c in range(len(input_list[0])):
            if input_list[r][c] not in [bg, 5]:
                input_list[r][c] = bg
    return tuple(tuple(row) for row in input_list)
