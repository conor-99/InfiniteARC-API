# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-04
# ---------------------------------------------------------------

"""
Task ID: 6b56f4bf
Difficulty: insane

=== Tags ===
- Pixel shader execution

=== Description ===
The input grid consists of a complex arrangement of interconnected colored
regions, where each region is defined by contiguous pixels of the same color.
The output grid is generated through three sequential, structure-based
transformations: (1) All 2×2 blocks of identical color are replaced with a
uniform target color (e.g., color 5), regardless of their original color; (2)
Every horizontal sequence of three or more contiguous pixels of the same color
is shifted right by one position, wrapping to the start of the row if necessary;
(3) All vertical sequences of four or more contiguous pixels of the same color
are recolored to a fixed target color (e.g., color 3). These transformations
must be applied in order, with overlapping patterns requiring careful sequential
processing. The input grids feature dense, overlapping structural elements
(e.g., intersecting horizontal/vertical runs, embedded 2×2 blocks), making the
task visually complex and demanding precise pattern recognition and multi-step
rule application. The rules rely solely on spatial relationships and
connectivity, avoiding numerical dependencies or color-value-based logic.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
def generate():
    width = random.randint(1, 30)
    height = random.randint(1, 30)
    grid = [[random.randint(0, 9) for _ in range(width)] for _ in range(height)]
    
    block_color = random.choice([c for c in range(10) if c != 5])
    for r in range(min(2, height)):
        for c in range(min(2, width)):
            grid[r][c] = block_color
    
    col = random.randint(0, width - 1)
    run_color = random.choice([c for c in range(10) if c != 3])
    for r in range(min(4, height)):
        grid[r][col] = run_color
    
    output = [row[:] for row in grid]
    
    for r in range(len(output) - 1):
        for c in range(len(output[0]) - 1):
            if output[r][c] == output[r][c+1] == output[r+1][c] == output[r+1][c+1]:
                output[r][c] = output[r][c+1] = output[r+1][c] = output[r+1][c+1] = 5
    
    for r in range(len(output)):
        i = 0
        while i < len(output[0]):
            color = output[r][i]
            j = i
            while j < len(output[0]) and output[r][j] == color:
                j += 1
            length = j - i
            if length >= 3:
                last = output[r][len(output[0]) - 1]
                for k in range(len(output[0]) - 1, i, -1):
                    output[r][k] = output[r][k - 1]
                output[r][i] = last
            i = j
    
    for c in range(len(output[0])):
        i = 0
        while i < len(output):
            color = output[i][c]
            j = i
            while j < len(output) and output[j][c] == color:
                j += 1
            length = j - i
            if length >= 4:
                for k in range(i, j):
                    output[k][c] = 3
            i = j
    
    return {"input": grid, "output": output}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    output = [list(row) for row in input_grid]
    height = len(output)
    width = len(output[0])
    
    for r in range(height - 1):
        for c in range(width - 1):
            if output[r][c] == output[r][c+1] == output[r+1][c] == output[r+1][c+1]:
                output[r][c] = output[r][c+1] = output[r+1][c] = output[r+1][c+1] = 5
    
    for r in range(height):
        i = 0
        while i < width:
            color = output[r][i]
            j = i
            while j < width and output[r][j] == color:
                j += 1
            length = j - i
            if length >= 3:
                last = output[r][width - 1]
                for k in range(width - 1, i, -1):
                    output[r][k] = output[r][k - 1]
                output[r][i] = last
            i = j
    
    for c in range(width):
        i = 0
        while i < height:
            color = output[i][c]
            j = i
            while j < height and output[j][c] == color:
                j += 1
            length = j - i
            if length >= 4:
                for k in range(i, j):
                    output[k][c] = 3
            i = j
    
    return output
