# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: e6136e07
Difficulty: hard

=== Tags ===
- Background filling
- Occlusion reasoning

=== Description ===
The task involves input grids where a complex, visually consistent background
pattern (composed of colors 1-9) is partially obscured by foreground objects
(non-zero colors). The background pattern follows a non-trivial repeating
sequence, such as a diagonal progression of three distinct colors (e.g., red →
green → blue → red → ...), which shifts along diagonals or rows. Foreground
objects (e.g., irregularly shaped shapes or overlapping structures) cover
portions of this background, creating occlusions. The output grid must retain
the foreground objects in their original positions while filling the background
(represented by color 0 in the input) with the correct pattern. The pattern must
be inferred from visible fragments of the background surrounding the occlusions,
requiring the solver to recognize the sequence's direction, periodicity, and
continuity. For hard difficulty, the background pattern uses a multi-color
diagonal sequence with overlapping foreground objects that cover non-contiguous
segments, demanding precise spatial reasoning to reconstruct the pattern across
occluded regions. The solution depends on identifying the repeating color order
through visual analysis of visible background segments, not numerical
calculations or memorization.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    input_grid = grid(width, height)
    output_grid = grid(width, height)
    
    for r in range(height):
        for c in range(width):
            color = (r + c) % 4 + 1
            output_grid[r][c] = color
            if random.random() < 0.2:
                input_grid[r][c] = 0
            else:
                input_grid[r][c] = color
    
    if input_grid == output_grid:
        return generate()
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    width = len(input_grid[0])
    height = len(input_grid)
    output_grid = [row[:] for row in input_grid]
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == 0:
                output_grid[r][c] = (r + c) % 4 + 1
    return output_grid
