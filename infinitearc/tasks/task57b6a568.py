# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-11
# ---------------------------------------------------------------

"""
Task ID: 57b6a568
Difficulty: very hard

=== Tags ===
- Mirrored attribute binding
- Mirror twins
- Associate colors to colors
- Pattern coloring

=== Description ===
The input grid consists of multiple distinct, contiguous colored regions (each
region is a connected group of cells with the same color, 0-9) arranged such
that each region has a mirror image counterpart across a single, consistent
mirror axis (e.g., vertical, horizontal, or diagonal) within the grid. The
mirror axis is not explicitly labeled but can be inferred from the symmetry of
the regions. In the output grid, each color in the input is replaced by the
color of its mirror twin region. For example, if a region of color A has a
mirror twin of color B, all instances of A are replaced with B and all instances
of B are replaced with A. Regions lying on the mirror axis (i.e., their mirror
image coincides with themselves) retain their original color. The transformation
requires identifying the mirror axis, associating each color with its twin's
color through the mirror symmetry, and applying this color substitution across
the entire grid. The complexity arises from the need to deduce the mirror axis
from visual patterns, handle multiple color associations, and correctly apply
the substitutions without overwriting or losing information during the
transformation.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    while True:
        width = random.randint(5, 30)
        height = random.randint(5, 30)
        axis = random.choice(['vertical', 'horizontal', 'diagonal'])
        
        input_grid = [[0] * width for _ in range(height)]
        colors = list(range(1, 10))
        random.shuffle(colors)
        pair1 = (colors[0], colors[1])
        pair2 = (colors[2], colors[3])
        
        if axis == 'vertical':
            mid = width // 2
            size1 = random.randint(2, 3)
            for r in range(size1):
                for c in range(size1):
                    if r < height and c < mid:
                        input_grid[r][c] = pair1[0]
            for r in range(size1):
                for c in range(size1):
                    if r < height and c < mid:
                        mirror_c = width - 1 - c
                        input_grid[r][mirror_c] = pair1[1]
            
            size2 = random.randint(2, 3)
            for r in range(height - size2, height):
                for c in range(size2):
                    if r < height and c < mid:
                        input_grid[r][c] = pair2[0]
            for r in range(height - size2, height):
                for c in range(size2):
                    if r < height and c < mid:
                        mirror_c = width - 1 - c
                        input_grid[r][mirror_c] = pair2[1]
        
        output_grid = [[0] * width for _ in range(height)]
        for r in range(height):
            for c in range(width):
                cell = input_grid[r][c]
                if cell == pair1[0]:
                    output_grid[r][c] = pair1[1]
                elif cell == pair1[1]:
                    output_grid[r][c] = pair1[0]
                elif cell == pair2[0]:
                    output_grid[r][c] = pair2[1]
                elif cell == pair2[1]:
                    output_grid[r][c] = pair2[0]
                else:
                    output_grid[r][c] = cell
        
        if input_grid != output_grid:
            return {'input': input_grid, 'output': output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    input_grid = [list(row) for row in input_grid]
    width = len(input_grid[0])
    height = len(input_grid)
    
    def check_vertical():
        mid = width // 2
        pairs = {}
        for r in range(height):
            for c in range(mid):
                mirror_c = width - 1 - c
                a = input_grid[r][c]
                b = input_grid[r][mirror_c]
                if a == b:
                    continue
                if a not in pairs:
                    pairs[a] = b
                elif pairs[a] != b:
                    return None
                if b not in pairs:
                    pairs[b] = a
                elif pairs[b] != a:
                    return None
        return pairs

    def check_horizontal():
        mid = height // 2
        pairs = {}
        for c in range(width):
            for r in range(mid):
                mirror_r = height - 1 - r
                a = input_grid[r][c]
                b = input_grid[mirror_r][c]
                if a == b:
                    continue
                if a not in pairs:
                    pairs[a] = b
                elif pairs[a] != b:
                    return None
                if b not in pairs:
                    pairs[b] = a
                elif pairs[b] != a:
                    return None
        return pairs

    def check_diagonal():
        pairs = {}
        for r in range(height):
            for c in range(width):
                if r == c:
                    continue
                mirror_r, mirror_c = c, r
                if mirror_r >= height or mirror_c >= width:
                    continue
                a = input_grid[r][c]
                b = input_grid[mirror_r][mirror_c]
                if a == b:
                    continue
                if a not in pairs:
                    pairs[a] = b
                elif pairs[a] != b:
                    return None
                if b not in pairs:
                    pairs[b] = a
                elif pairs[b] != a:
                    return None
        return pairs

    pairs = check_vertical()
    if pairs is None:
        pairs = check_horizontal()
    if pairs is None:
        pairs = check_diagonal()
    
    output_grid = [[0] * width for _ in range(height)]
    for r in range(height):
        for c in range(width):
            cell = input_grid[r][c]
            output_grid[r][c] = pairs.get(cell, cell)
    
    return tuple(tuple(row) for row in output_grid)
