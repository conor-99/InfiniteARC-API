# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 285c586e
Difficulty: insane

=== Tags ===
- Direction guesingcrop

=== Description ===
The task involves transforming an input grid into an output grid based on the
direction inferred from a specific 2x2 crop at the top-left corner. The crop is
analyzed to locate the maximum value within its four cells. The position of this
maximum (top-left, top-right, bottom-right, or bottom-left) corresponds to a
direction: top-left → up, top-right → right, bottom-right → down, bottom-left →
left. The output grid is generated by shifting all elements of the input grid in
the determined direction, with elements wrapping around the grid boundaries
(e.g., shifting right moves the rightmost column to the leftmost position). This
requires identifying the crop, mapping the max position to a direction, and
applying a consistent wrap-around shift to all rows or columns based on that
direction. The rule is abstract, deterministic, and discoverable through
observation of input-output pairs, making it challenging for "insane"
difficulty.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random
from common import grid

def shift_grid(grid, direction):
    if direction == 'right':
        return [row[-1:] + row[:-1] for row in grid]
    elif direction == 'left':
        return [row[1:] + row[:1] for row in grid]
    elif direction == 'up':
        columns = list(zip(*grid))
        shifted_columns = [col[1:] + (col[0],) for col in columns]
        return [list(col) for col in zip(*shifted_columns)]
    elif direction == 'down':
        columns = list(zip(*grid))
        shifted_columns = [(col[-1],) + col[:-1] for col in columns]
        return [list(col) for col in zip(*shifted_columns)]

def generate():
    while True:
        width = random.randint(2, 30)
        height = random.randint(2, 30)
        input_grid = grid(width, height, 0)
        pos = random.choice([(0,0), (0,1), (1,0), (1,1)])
        input_grid[pos[0]][pos[1]] = 9
        for i in range(2):
            for j in range(2):
                if (i, j) != pos:
                    input_grid[i][j] = random.randint(0, 8)
        for r in range(height):
            for c in range(width):
                if r < 2 and c < 2:
                    continue
                input_grid[r][c] = random.randint(0, 9)
        if pos == (0,0):
            direction = 'up'
        elif pos == (0,1):
            direction = 'right'
        elif pos == (1,1):
            direction = 'down'
        else:
            direction = 'left'
        output_grid = shift_grid(input_grid, direction)
        if input_grid != output_grid:
            return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

from common import grid

def shift_grid(grid, direction):
    if direction == 'right':
        return [row[-1:] + row[:-1] for row in grid]
    elif direction == 'left':
        return [row[1:] + row[:1] for row in grid]
    elif direction == 'up':
        columns = list(zip(*grid))
        shifted_columns = [col[1:] + (col[0],) for col in columns]
        return [list(col) for col in zip(*shifted_columns)]
    elif direction == 'down':
        columns = list(zip(*grid))
        shifted_columns = [(col[-1],) + col[:-1] for col in columns]
        return [list(col) for col in zip(*shifted_columns)]

def p(input_grid):
    top2x2 = [row[:2] for row in input_grid[:2]]
    max_val = -1
    max_pos = None
    for i in range(2):
        for j in range(2):
            if top2x2[i][j] > max_val:
                max_val = top2x2[i][j]
                max_pos = (i, j)
    if max_pos == (0,0):
        direction = 'up'
    elif max_pos == (0,1):
        direction = 'right'
    elif max_pos == (1,1):
        direction = 'down'
    else:
        direction = 'left'
    return shift_grid(input_grid, direction)
