# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-06
# ---------------------------------------------------------------

"""
Task ID: 45b32d06
Difficulty: mediumâ€“hard

=== Tags ===
- Periodic offset matching
- Associate images to patterns

=== Description ===
Input grids consist of a background color with a sequence of 2x2 solid-colored
blocks arranged diagonally, where each block's top-left corner is offset right
and down by one cell from the previous block. The blocks are separated by
background cells and maintain distinct colors. The output grid corrects this
diagonal arrangement by shifting each block upward by its original row index,
aligning all blocks into a horizontal line along the top row. This
transformation aligns the periodic diagonal offset into a consistent horizontal
pattern, preserving the background and block colors without overlap or
distortion. The background remains unchanged, and the correction applies
uniformly across all blocks to reveal the underlying periodic structure.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    k = random.randint(3, 5)
    colors = random.sample(range(1, 10), k)
    size = 2 * k + 2
    bg = 0
    input_grid = [[bg] * size for _ in range(size)]
    output_grid = [[bg] * size for _ in range(size)]
    
    for i in range(k):
        color = colors[i]
        for r in range(2 * i, 2 * i + 2):
            for c in range(2 * i, 2 * i + 2):
                input_grid[r][c] = color
        for r in range(2):
            for c in range(2 * i, 2 * i + 2):
                output_grid[r][c] = color
    
    return {
        "input": input_grid,
        "output": output_grid
    }


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = [[0] * width for _ in range(height)]
    
    blocks = []
    for r in range(height - 1):
        for c in range(width - 1):
            color = input_grid[r][c]
            if color == 0:
                continue
            if (input_grid[r][c] == input_grid[r][c+1] == 
                input_grid[r+1][c] == input_grid[r+1][c+1]):
                blocks.append((r, c, color))
    
    blocks.sort(key=lambda x: x[0])
    for r, c, color in blocks:
        for dr in range(2):
            for dc in range(2):
                if 0 <= dr < height and 0 <= c + dc < width:
                    output_grid[dr][c + dc] = color
    
    return output_grid
