# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: abe08c56
Difficulty: hard

=== Tags ===
- Detect grid
- Image filling

=== Description ===
The task involves detecting a grid structure formed by a specific color (8) and
filling all enclosed regions within this structure with another color (5). The
input grid contains a connected network of color 8 lines that may form multiple
closed loops or irregular shapes, dividing the grid into enclosed areas. The
output grid replaces all cells that are enclosed by these lines (i.e., cells not
reachable from the grid's border without crossing color 8 lines) with color 5,
while retaining the color 8 lines. This requires identifying enclosed regions
through connectivity analysis, as regions internally surrounded by color 8 lines
are filled, while border-connected areas remain unchanged. The complexity arises
from the irregularity of the grid lines, which may form nested loops or
fragmented structures, demanding precise detection of enclosed spaces through
visual reasoning rather than simple pattern matching.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import common
from collections import deque

def generate():
    width = common.randint(5, 30)
    height = common.randint(5, 30)
    m = common.randint(3, min(width, height) - 2)
    top_left_row = common.randint(1, height - m - 1)
    top_left_col = common.randint(1, width - m - 1)
    input_grid = common.grid(width, height, 0)
    for c in range(top_left_col, top_left_col + m):
        input_grid[top_left_row][c] = 8
        input_grid[top_left_row + m - 1][c] = 8
    for r in range(top_left_row + 1, top_left_row + m - 1):
        input_grid[r][top_left_col] = 8
        input_grid[r][top_left_col + m - 1] = 8
    visited = [[False] * width for _ in range(height)]
    q = deque()
    for r in range(height):
        for c in [0, width - 1]:
            if input_grid[r][c] == 0 and not visited[r][c]:
                visited[r][c] = True
                q.append((r, c))
    for c in range(width):
        for r in [0, height - 1]:
            if input_grid[r][c] == 0 and not visited[r][c]:
                visited[r][c] = True
                q.append((r, c))
    while q:
        r, c = q.popleft()
        for dr, dc in [(1, 0), (-1, 0), (0, 1), (0, -1)]:
            nr, nc = r + dr, c + dc
            if 0 <= nr < height and 0 <= nc < width and not visited[nr][nc] and input_grid[nr][nc] == 0:
                visited[nr][nc] = True
                q.append((nr, nc))
    output_grid = [row[:] for row in input_grid]
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == 0 and not visited[r][c]:
                output_grid[r][c] = 5
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

import common
from collections import deque

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    visited = [[False] * width for _ in range(height)]
    q = deque()
    for r in range(height):
        for c in [0, width - 1]:
            if input_grid[r][c] == 0 and not visited[r][c]:
                visited[r][c] = True
                q.append((r, c))
    for c in range(width):
        for r in [0, height - 1]:
            if input_grid[r][c] == 0 and not visited[r][c]:
                visited[r][c] = True
                q.append((r, c))
    while q:
        r, c = q.popleft()
        for dr, dc in [(1, 0), (-1, 0), (0, 1), (0, -1)]:
            nr, nc = r + dr, c + dc
            if 0 <= nr < height and 0 <= nc < width and not visited[nr][nc] and input_grid[nr][nc] == 0:
                visited[nr][nc] = True
                q.append((nr, nc))
    output_grid = [list(row) for row in input_grid]
    for r in range(height):
        for c in range(width):
            if input_grid[r][c] == 0 and not visited[r][c]:
                output_grid[r][c] = 5
    return output_grid
