# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-08
# ---------------------------------------------------------------

"""
Task ID: b2449c28
Difficulty: medium

=== Tags ===
- Propagate label
- Color by rank in row
- Separate image

=== Description ===
The input grid consists of a 2D array with values between 0 and 9, where 0
represents background. Each row contains one or more connected regions of non-
zero values separated by background (0). For each row, the leftmost connected
region is assigned rank 1, the next rank 2, and so on. Each cell in a region is
replaced with a color value equal to 3 plus its rank (e.g., rank 1 becomes 3,
rank 2 becomes 4). This transformation separates overlapping regions into
distinct color-coded segments per row while ensuring no input grid matches its
output. The task requires identifying regions per row, assigning ranks, and
propagating the rank-based color through each connected component.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

import random

def generate():
    width = random.randint(1, 30)
    height = random.randint(1, 30)
    input_grid = [[0] * width for _ in range(height)]
    
    for r in range(height):
        num_regions = random.randint(1, min(5, width))
        lengths = []
        remaining = width
        for i in range(num_regions):
            max_len = remaining - (num_regions - i - 1)
            length = random.randint(1, max_len)
            lengths.append(length)
            remaining -= length
        current = 0
        for i, length in enumerate(lengths):
            valid_colors = [c for c in range(1, 10) if c != 3 + i]
            color = random.choice(valid_colors)
            for j in range(length):
                if current < width:
                    input_grid[r][current] = color
                    current += 1
            if current < width:
                input_grid[r][current] = 0
                current += 1
        for j in range(current, width):
            input_grid[r][j] = 0
    
    output_grid = [[0] * width for _ in range(height)]
    for r in range(height):
        regions = []
        current_region = []
        for c in range(width):
            if input_grid[r][c] != 0:
                current_region.append(c)
            else:
                if current_region:
                    regions.append(current_region)
                    current_region = []
        if current_region:
            regions.append(current_region)
        for idx, region in enumerate(regions):
            color = 3 + idx
            for c in region:
                output_grid[r][c] = color
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = [[0] * width for _ in range(height)]
    
    for r in range(height):
        regions = []
        current_region = []
        for c in range(width):
            if input_grid[r][c] != 0:
                current_region.append(c)
            else:
                if current_region:
                    regions.append(current_region)
                    current_region = []
        if current_region:
            regions.append(current_region)
        for idx, region in enumerate(regions):
            color = 3 + idx
            for c in region:
                output_grid[r][c] = color
    return output_grid
