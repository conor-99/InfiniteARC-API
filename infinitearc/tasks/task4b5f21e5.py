# ---------------------------------------------------------------
# This file was automatically generated. DO NOT EDIT MANUALLY.
# 
# Generated by: conor-99/InfiniteARC/prepare.py
# Date: 2025-11-09
# ---------------------------------------------------------------

"""
Task ID: 4b5f21e5
Difficulty: hard

=== Tags ===
- Pixelwise xor composition
- Weave patterns
- Topological invariance

=== Description ===
The input grid contains a complex arrangement of colors forming multiple
distinct, interconnected regions, each with unique shapes and topological
properties. The output grid is generated through a multi-stage transformation
that enforces topological invariance while creating a woven visual pattern.
First, the grid undergoes a row-wise weaving operation: even-indexed rows are
cyclically shifted right by one position, and odd-indexed rows are cyclically
shifted left by one position. This interlaces adjacent rows to create a braided
effect, preserving the connectivity of each color's region (topological
invariance). Second, a pixelwise composition rule is applied where each color's
arrangement is visually "combined" with neighboring colors in a non-arithmetic,
pattern-based manner—resembling the overlapping of fabric threads in a
weave—without altering the core topological structure of the regions. The
transformation maintains the number of connected components for each color while
reconfiguring their spatial relationships into a visually cohesive woven
pattern. The difficulty arises from the need to simultaneously recognize the
row-shift weaving rule, verify topological preservation across all color
regions, and interpret the non-arithmetic visual composition of overlapping
color patterns.
"""


# ---------------------------------------------------------------
# Generator Code
# ---------------------------------------------------------------

from common import grid, random_color
import random
def generate():
    width = random.randint(5, 30)
    height = random.randint(5, 30)
    input_grid = grid(width, height, 0)
    color1 = random_color()
    color2 = random_color(exclude=[color1])
    
    # Top-left region
    h1 = random.randint(2, height // 2)
    w1 = random.randint(2, width // 2)
    for r in range(h1):
        for c in range(w1):
            input_grid[r][c] = color1
    
    # Bottom-right region
    h2 = random.randint(2, height // 2)
    w2 = random.randint(2, width // 2)
    start_r = height - h2
    start_c = width - w2
    for r in range(start_r, height):
        for c in range(start_c, width):
            input_grid[r][c] = color2
    
    output_grid = [row[:] for row in input_grid]
    for i in range(height):
        if i % 2 == 0:
            output_grid[i] = [output_grid[i][-1]] + output_grid[i][:-1]
        else:
            output_grid[i] = output_grid[i][1:] + [output_grid[i][0]]
    return {"input": input_grid, "output": output_grid}


# ---------------------------------------------------------------
# Solver Code
# ---------------------------------------------------------------

def p(input_grid):
    if isinstance(input_grid, tuple):
        input_grid = [list(row) for row in input_grid]
    height = len(input_grid)
    width = len(input_grid[0])
    output_grid = [row[:] for row in input_grid]
    for i in range(height):
        if i % 2 == 0:
            output_grid[i] = [output_grid[i][-1]] + output_grid[i][:-1]
        else:
            output_grid[i] = output_grid[i][1:] + [output_grid[i][0]]
    return output_grid
